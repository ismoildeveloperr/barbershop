!function(){"use strict";!function(t,e,s){class n{constructor(t){this.$element=t,this.type=t.data("type"),this.$element.attr("data-inited","true")}}class i extends n{constructor(t){super(t),this.$input=t.find("input").first(),this.$input.spectrum()}}let a="/motopress/appointment/v1";function r(t,e={}){return function(t,e={},s="GET"){return new Promise(((n,i)=>{wp.apiRequest({path:a+t,type:s,data:e}).done((t=>n(t))).fail(((t,e)=>{let s="parsererror";s=t.responseJSON&&t.responseJSON.message?t.responseJSON.message:`Status: ${e}`,"parsererror"==s&&(s="REST request failed. Maybe PHP error on the server side. Check PHP logs."),i(new Error(s))}))}))}(t,e,"GET")}class o{constructor(){this.settings=this.getDefaults(),this.loadingPromise=this.load()}getDefaults(){return{plugin_name:"Appointment Booking",today:"2030-01-01",business_name:"",default_time_step:30,default_booking_status:"confirmed",confirmation_mode:"auto",terms_page_id_for_acceptance:0,allow_multibooking:!1,allow_coupons:!1,allow_customer_account_creation:!1,country:"",currency:"EUR",currency_symbol:"&euro;",currency_position:"before",decimal_separator:".",thousand_separator:",",number_of_decimals:2,timezone:"UTC",date_format:"F j, Y",time_format:"H:i",week_starts_on:0,thumbnail_size:{width:150,height:150},flatpickr_locale:"en",enable_payments:!1,active_gateways:[],reservation_received_page_url:"",failed_transaction_page_url:"",default_payment_gateway:""}}load(){return new Promise(((t,e)=>{r("/settings").then((t=>this.settings=t),(t=>console.error("Unable to load public settings.",t))).finally((()=>t(this.settings)))}))}ready(){return this.loadingPromise}getPluginName(){return this.settings.plugin_name}getBusinessDate(){return this.settings.today}getBusinessName(){return this.settings.business_name}getTimeStep(){return this.settings.default_time_step}getDefaultBookingStatus(){return this.settings.default_booking_status}getConfirmationMode(){return this.settings.confirmation_mode}getTermsPageIdForAcceptance(){return this.settings.terms_page_id_for_acceptance}isMultibookingEnabled(){return this.settings.allow_multibooking}isCouponsEnabled(){return this.settings.allow_coupons}isAllowCustomerAccountCreation(){return this.settings.allow_customer_account_creation}getCountry(){return this.settings.country}getCurrency(){return this.settings.currency}getCurrencySymbol(){return this.settings.currency_symbol}getCurrencyPosition(){return this.settings.currency_position}getDecimalSeparator(){return this.settings.decimal_separator}getThousandSeparator(){return this.settings.thousand_separator}getDecimalsCount(){return this.settings.number_of_decimals}getTimezone(){return this.settings.timezone}getDateFormat(){return this.settings.date_format}getTimeFormat(){return this.settings.time_format}getFirstDayOfWeek(){return this.settings.week_starts_on}getThumbnailSize(){return this.settings.thumbnail_size}getFlatpickrLocale(){return this.settings.flatpickr_locale}isPaymentsEnabled(){return this.settings.enable_payments}getActiveGateways(){return this.settings.active_gateways}getReservationReceivedPageUrl(){return this.settings.reservation_received_page_url}getFailedTransactionPageUrl(){return this.settings.failed_transaction_page_url}getDefaultPaymentGateway(){return this.settings.default_payment_gateway}}class p{constructor(){this.settingsCtrl=new o,this.loadingPromise=this.load()}load(){return Promise.all([this.settingsCtrl.ready()]).then((()=>this))}ready(){return this.loadingPromise}settings(){return this.settingsCtrl}static getInstance(){return null==p.instance&&(p.instance=new p),p.instance}}const m="undefined"!=typeof wp&&wp.i18n&&wp.i18n.__?wp.i18n.__:(t,e="")=>t,u="undefined"!=typeof wp&&wp.i18n&&wp.i18n._x?wp.i18n._x:(t,e,s="")=>t;"undefined"!=typeof wp&&wp.i18n&&wp.i18n.sprintf&&wp.i18n.sprintf,m("Sun","motopress-appointment"),m("Mon","motopress-appointment"),m("Tue","motopress-appointment"),m("Wed","motopress-appointment"),m("Thu","motopress-appointment"),m("Fri","motopress-appointment"),m("Sat","motopress-appointment"),m("Sunday","motopress-appointment"),m("Monday","motopress-appointment"),m("Tuesday","motopress-appointment"),m("Wednesday","motopress-appointment"),m("Thursday","motopress-appointment"),m("Friday","motopress-appointment"),m("Saturday","motopress-appointment"),m("Jan","motopress-appointment"),m("Feb","motopress-appointment"),m("Mar","motopress-appointment"),m("Apr","motopress-appointment"),u("May","Month (short)","motopress-appointment"),m("Jun","motopress-appointment"),m("Jul","motopress-appointment"),m("Aug","motopress-appointment"),m("Sep","motopress-appointment"),m("Oct","motopress-appointment"),m("Nov","motopress-appointment"),m("Dec","motopress-appointment"),m("January","motopress-appointment"),m("February","motopress-appointment"),m("March","motopress-appointment"),m("April","motopress-appointment"),u("May","Month","motopress-appointment"),m("June","motopress-appointment"),m("July","motopress-appointment"),m("August","motopress-appointment"),m("September","motopress-appointment"),m("October","motopress-appointment"),m("November","motopress-appointment"),m("December","motopress-appointment"),p.getInstance().settings().getFirstDayOfWeek();class l extends n{constructor(t){super(t),this.setupProperties(),this.addListeners()}setupProperties(){this.$input=this.$element.find('input[type="hidden"]'),this.$preview=this.$element.find(".mpa-preview-wrapper > img"),this.$addButton=this.$element.find(".mpa-add-media"),this.$removeButton=this.$element.find(".mpa-remove-media"),this.thumbnailSize=this.$input.attr("thumbnail-size")}addListeners(){this.$preview.on("click",this.selectMedia.bind(this)),this.$addButton.on("click",this.selectMedia.bind(this)),this.$removeButton.on("click",this.removeMedia.bind(this))}getRawValue(){return this.$input.val()}getValue(){return function(t){let e=parseInt(t);return isNaN(e)?t<<0:e}(this.getRawValue())}setValue(t){this.updateValue(t),this.react()}updateValue(t){this.$input.val(t)}react(){let t=!!this.getValue();this.$addButton.toggleClass("mpa-hide",t),this.$removeButton.toggleClass("mpa-hide",!t),t?this.updatePreview():this.resetPreview()}updatePreview(){let t=wp.media.attachment(this.getValue()).attributes.sizes[this.thumbnailSize].url;this.$preview.removeClass("mpa-hide").attr("src",t)}resetPreview(){this.$preview.addClass("mpa-hide").attr("src","")}selectMedia(t){t.preventDefault();let e=wp.media({multiple:!1});e.open().on("select",(t=>{let s=e.state().get("selection").first().toJSON().id;this.setValue(s)}))}removeMedia(t){t.preventDefault(),this.setValue("")}}window.mpa_intl_tel_input=function(t){const n=jQuery("<span/>",{id:t.attr("id")+"_error",class:"mpa-phone-field-error mpa-hide",text:m("Phone number is invalid.","motopress-appointment")});t.after("<br>",n);const i=e(t[0],{separateDialCode:!0,initialCountry:s.settings.country,hiddenInput:t.attr("name"),utilsScript:s.urls.plugin+"assets/js/intl-tel-input-17.0.19/js/utils.js"});i.promise.then((()=>{t.val()&&a(),t.on("countrychange",(t=>{a()})),t.on("input",(t=>{a()}))}));const a=()=>{i.isValidNumber()?(jQuery("input[type='hidden'][name='"+t.attr("name")+"']").val(i.getNumber(intlTelInputUtils.numberFormat.E164)),t.removeClass("mpa-phone-number--invalid"),n.addClass("mpa-hide")):(t.addClass("mpa-phone-number--invalid"),n.removeClass("mpa-hide"))};return i};class d{initSettings(){this.initPaymentMethodsDependency(),this.initPaymentMethodConfigurationDependency()}initPaymentMethodsDependency(){const t=jQuery("#mpa_stripe_payment_gateway_payment_methods-card"),e=jQuery("#mpa_stripe_payment_gateway_payment_methods-apple_pay, #mpa_stripe_payment_gateway_payment_methods-google_pay, #mpa_stripe_payment_gateway_payment_methods-link");t.click((t=>{t.target.checked||e.prop("checked",!1)})),e.click((e=>{e.target.checked&&t.prop("checked",!0)}))}initPaymentMethodConfigurationDependency(){const t=jQuery("#mpa_stripe_payment_gateway_payment_methods-payment").closest("label"),e=jQuery("#mpa_stripe_payment_gateway_payment_method_configuration"),s=e.closest(".mpa-ctrl"),n=e.closest(".mpa-ctrl-wrapper"),i=n.find("label");s.prepend("<br>"),s.prepend(i),s.prepend("<br>"),s.detach().insertAfter(t),n.addClass("mpa-hide")}}new class{constructor(){this.setupFields(jQuery(".mpa-ctrl:not([data-inited])")),this.stripeSettings=new d,this.stripeSettings.initSettings()}setupFields(t){t.each((function(t,e){let s=jQuery(e);switch(s.attr("data-type")){case"color-picker":new i(s);break;case"image":new l(s)}}))}}}(wp.date,intlTelInput,mpaData)}();
