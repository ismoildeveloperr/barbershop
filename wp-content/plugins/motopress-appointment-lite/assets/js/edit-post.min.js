!function(){"use strict";!function(e,t,i){class s{constructor(e){this.$element=e,this.type=e.data("type"),this.$element.attr("data-inited","true")}}class a extends s{constructor(e){super(e),this.$input=e.find("input").first(),this.$input.spectrum()}}let r="/motopress/appointment/v1";function n(e,t={}){return function(e,t={},i="GET"){return new Promise(((s,a)=>{wp.apiRequest({path:r+e,type:i,data:t}).done((e=>s(e))).fail(((e,t)=>{let i="parsererror";i=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:`Status: ${t}`,"parsererror"==i&&(i="REST request failed. Maybe PHP error on the server side. Check PHP logs."),a(new Error(i))}))}))}(e,t,"GET")}class o{constructor(){this.settings=this.getDefaults(),this.loadingPromise=this.load()}getDefaults(){return{plugin_name:"Appointment Booking",today:"2030-01-01",business_name:"",default_time_step:30,default_booking_status:"confirmed",confirmation_mode:"auto",terms_page_id_for_acceptance:0,allow_multibooking:!1,allow_coupons:!1,allow_customer_account_creation:!1,country:"",currency:"EUR",currency_symbol:"&euro;",currency_position:"before",decimal_separator:".",thousand_separator:",",number_of_decimals:2,timezone:"UTC",date_format:"F j, Y",time_format:"H:i",week_starts_on:0,thumbnail_size:{width:150,height:150},flatpickr_locale:"en",enable_payments:!1,active_gateways:[],reservation_received_page_url:"",failed_transaction_page_url:"",default_payment_gateway:""}}load(){return new Promise(((e,t)=>{n("/settings").then((e=>this.settings=e),(e=>console.error("Unable to load public settings.",e))).finally((()=>e(this.settings)))}))}ready(){return this.loadingPromise}getPluginName(){return this.settings.plugin_name}getBusinessDate(){return this.settings.today}getBusinessName(){return this.settings.business_name}getTimeStep(){return this.settings.default_time_step}getDefaultBookingStatus(){return this.settings.default_booking_status}getConfirmationMode(){return this.settings.confirmation_mode}getTermsPageIdForAcceptance(){return this.settings.terms_page_id_for_acceptance}isMultibookingEnabled(){return this.settings.allow_multibooking}isCouponsEnabled(){return this.settings.allow_coupons}isAllowCustomerAccountCreation(){return this.settings.allow_customer_account_creation}getCountry(){return this.settings.country}getCurrency(){return this.settings.currency}getCurrencySymbol(){return this.settings.currency_symbol}getCurrencyPosition(){return this.settings.currency_position}getDecimalSeparator(){return this.settings.decimal_separator}getThousandSeparator(){return this.settings.thousand_separator}getDecimalsCount(){return this.settings.number_of_decimals}getTimezone(){return this.settings.timezone}getDateFormat(){return this.settings.date_format}getTimeFormat(){return this.settings.time_format}getFirstDayOfWeek(){return this.settings.week_starts_on}getThumbnailSize(){return this.settings.thumbnail_size}getFlatpickrLocale(){return this.settings.flatpickr_locale}isPaymentsEnabled(){return this.settings.enable_payments}getActiveGateways(){return this.settings.active_gateways}getReservationReceivedPageUrl(){return this.settings.reservation_received_page_url}getFailedTransactionPageUrl(){return this.settings.failed_transaction_page_url}getDefaultPaymentGateway(){return this.settings.default_payment_gateway}}class l{constructor(){this.settingsCtrl=new o,this.loadingPromise=this.load()}load(){return Promise.all([this.settingsCtrl.ready()]).then((()=>this))}ready(){return this.loadingPromise}settings(){return this.settingsCtrl}static getInstance(){return null==l.instance&&(l.instance=new l),l.instance}}function h(){return l.getInstance()}const c="undefined"!=typeof wp&&wp.i18n&&wp.i18n.__?wp.i18n.__:(e,t="")=>e,d="undefined"!=typeof wp&&wp.i18n&&wp.i18n._x?wp.i18n._x:(e,t,i="")=>e,p="undefined"!=typeof wp&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(e,...t)=>{let i=0;return e.replace(/%([sdf])/g,((e,s)=>{if(i>=t.length)return e;let a=t[i++];switch(s){case"s":return String(a);case"d":return parseInt(a,10);case"f":return parseFloat(a);default:return e}}))},u={weekdays:{shorthand:[c("Sun","motopress-appointment"),c("Mon","motopress-appointment"),c("Tue","motopress-appointment"),c("Wed","motopress-appointment"),c("Thu","motopress-appointment"),c("Fri","motopress-appointment"),c("Sat","motopress-appointment")],longhand:[c("Sunday","motopress-appointment"),c("Monday","motopress-appointment"),c("Tuesday","motopress-appointment"),c("Wednesday","motopress-appointment"),c("Thursday","motopress-appointment"),c("Friday","motopress-appointment"),c("Saturday","motopress-appointment")]},months:{shorthand:[c("Jan","motopress-appointment"),c("Feb","motopress-appointment"),c("Mar","motopress-appointment"),c("Apr","motopress-appointment"),d("May","Month (short)","motopress-appointment"),c("Jun","motopress-appointment"),c("Jul","motopress-appointment"),c("Aug","motopress-appointment"),c("Sep","motopress-appointment"),c("Oct","motopress-appointment"),c("Nov","motopress-appointment"),c("Dec","motopress-appointment")],longhand:[c("January","motopress-appointment"),c("February","motopress-appointment"),c("March","motopress-appointment"),c("April","motopress-appointment"),d("May","Month","motopress-appointment"),c("June","motopress-appointment"),c("July","motopress-appointment"),c("August","motopress-appointment"),c("September","motopress-appointment"),c("October","motopress-appointment"),c("November","motopress-appointment"),c("December","motopress-appointment")]},amPM:["AM","PM"],firstDayOfWeek:h().settings().getFirstDayOfWeek()};function m(t,i="public"){if("string"==typeof t)return t;if("internal"==i)return m(t,"Y-m-d");if("public"==i)return e.format(h().settings().getDateFormat(),t);let s=(e,t=2)=>("00"+e).slice(-t),a=!1;return i.split("").map((e=>{if(a)return a=!1,e;switch(e){case"\\":return a=!0,"";case"j":return t.getDate();case"d":return s(t.getDate());case"D":return u.weekdays.shorthand[t.getDay()];case"l":return u.weekdays.longhand[t.getDay()];case"N":return t.getDay()||7;case"w":return t.getDay();case"z":let i=new Date(t.getFullYear(),0,1),r=i.getTimezoneOffset()-t.getTimezoneOffset(),n=t-i+60*r*1e3,o=864e5;return Math.floor(n/o);case"W":let l=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),h=l.getUTCDay()||7;l.setUTCDate(l.getUTCDate()+4-h);let c=new Date(Date.UTC(l.getUTCFullYear(),0,1)),d=864e5;return Math.ceil(((l-c)/d+1)/7);case"F":return u.months.longhand[t.getMonth()];case"M":return u.months.shorthand[t.getMonth()];case"m":return s(t.getMonth()+1);case"n":return t.getMonth()+1;case"t":return new Date(t.getFullYear(),t.getMonth()+1,0).getDate();case"Y":return t.getFullYear();case"y":return String(t.getFullYear()).substring(2);case"L":return t.getFullYear()%4==0?1:0;case"A":return u.amPM[t.getHours()>11?1:0];case"a":return u.amPM[t.getHours()>11?1:0].toLowerCase();case"H":return s(t.getHours());case"h":return s(t.getHours()%12||12);case"G":return t.getHours();case"g":return t.getHours()%12||12;case"i":return s(t.getMinutes());case"s":return s(t.getSeconds());case"v":return s(t.getMilliseconds(),3);case"u":return s(t.getMilliseconds(),3)+"000";case"O":case"P":let p=-t.getTimezoneOffset(),y=p>=0?"+":"-",g=Math.floor(Math.abs(p)/60),v=Math.abs(p)%60,f="O"==e?"":":";return y+s(g)+f+s(v);case"Z":return 60*t.getTimezoneOffset();case"U":return Math.floor(t.getTime()/1e3);case"c":return m(t,"Y-m-d\\TH:i:sP");case"r":return m(t,"D, d M Y H:i:s O");case"S":case"o":case"B":case"e":case"T":case"I":return"";default:return e}})).join("")}function y(e){let t=e.match(/(\d{4})-(\d{2})-(\d{2})/);if(null!=t){let e=parseInt(t[1]),i=parseInt(t[2]),s=parseInt(t[3]);return new Date(e,i-1,s)}return null}function g(){let e=new Date;return e.setHours(0,0,0,0),e}function v(e,t){let i=t.locale||h().settings().getFlatpickrLocale(),s=flatpickr.l10ns[i]||i;"object"==typeof s&&(s.firstDayOfWeek=h().settings().getFirstDayOfWeek());let a={formatDate:m,inline:!0,locale:s,monthSelectorType:"static",showMonths:1};t=jQuery.extend({},a,t);let r=null;return r=e instanceof jQuery?flatpickr(e[0],t):flatpickr(e,t),r}class f extends s{constructor(e){super(e),this.$dateInput=this.$element.find(".mpa-date-input").first(),this.datepicker=null,this.displayFormat=this.$element.data("display-format"),this.sizeClass=this.$element.data("size"),this.initDatepicker(),this.removePreloader()}initDatepicker(){this.datepicker=v(this.$dateInput,{altFormat:this.displayFormat,altInput:!0,altInputClass:"mpa-alt-date-input "+this.sizeClass,inline:!1,showMonths:2}),this.$dateInput.prop("disabled")&&this.$element.find(".mpa-alt-date-input").prop("disabled",!0)}removePreloader(){this.$element.find(".mpa-preloader").remove()}}function b(e){return!!e}function S(e){let t=parseInt(e);return isNaN(t)?e<<0:t}class $ extends s{constructor(e){super(e),this.setupProperties(),this.addListeners()}setupProperties(){this.$input=this.$element.find('input[type="hidden"]'),this.$preview=this.$element.find(".mpa-preview-wrapper > img"),this.$addButton=this.$element.find(".mpa-add-media"),this.$removeButton=this.$element.find(".mpa-remove-media"),this.thumbnailSize=this.$input.attr("thumbnail-size")}addListeners(){this.$preview.on("click",this.selectMedia.bind(this)),this.$addButton.on("click",this.selectMedia.bind(this)),this.$removeButton.on("click",this.removeMedia.bind(this))}getRawValue(){return this.$input.val()}getValue(){return S(this.getRawValue())}setValue(e){this.updateValue(e),this.react()}updateValue(e){this.$input.val(e)}react(){let e=b(this.getValue());this.$addButton.toggleClass("mpa-hide",e),this.$removeButton.toggleClass("mpa-hide",!e),e?this.updatePreview():this.resetPreview()}updatePreview(){let e=wp.media.attachment(this.getValue()).attributes.sizes[this.thumbnailSize].url;this.$preview.removeClass("mpa-hide").attr("src",e)}resetPreview(){this.$preview.addClass("mpa-hide").attr("src","")}selectMedia(e){e.preventDefault();let t=wp.media({multiple:!1});t.open().on("select",(e=>{let i=t.state().get("selection").first().toJSON().id;this.setValue(i)}))}removeMedia(e){e.preventDefault(),this.setValue("")}}function w(e){const s=jQuery("<span/>",{id:e.attr("id")+"_error",class:"mpa-phone-field-error mpa-hide",text:c("Phone number is invalid.","motopress-appointment")});e.after("<br>",s);const a=t(e[0],{separateDialCode:!0,initialCountry:i.settings.country,hiddenInput:e.attr("name"),utilsScript:i.urls.plugin+"assets/js/intl-tel-input-17.0.19/js/utils.js"});a.promise.then((()=>{e.val()&&r(),e.on("countrychange",(e=>{r()})),e.on("input",(e=>{r()}))}));const r=()=>{a.isValidNumber()?(jQuery("input[type='hidden'][name='"+e.attr("name")+"']").val(a.getNumber(intlTelInputUtils.numberFormat.E164)),e.removeClass("mpa-phone-number--invalid"),s.addClass("mpa-hide")):(e.addClass("mpa-phone-number--invalid"),s.removeClass("mpa-hide"))};return a}window.mpa_intl_tel_input=w;class I extends s{constructor(e){super(e),this.$input=e.find("input").first(),w(this.$input)}}let T={};function _(e,t=!1){return"object"==typeof e?0==function(e,t=!1){return"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:t?0:1}(e):!!t||!e}function C(e="",t=!1){let i=function(e,t){return t<(e=parseInt(e,10).toString(16)).length?e.slice(e.length-t):t>e.length?Array(t-e.length+1).join("0")+e:e};T.uniqid_seed||(T.uniqid_seed=Math.floor(123456789*Math.random())),T.uniqid_seed++;let s=e;return s+=i(parseInt((new Date).getTime()/1e3,10),8),s+=i(T.uniqid_seed,5),t&&(s+=(10*Math.random()).toFixed(8).toString()),s}function k(e){return e.filter(((e,t,i)=>i.indexOf(e)===t))}function P(e,t){return e.filter((e=>-1!=t.indexOf(e)))}function D(e,t){let i=Math.min(e.length,t.length),s={};for(let a=0;a<i;a++)s[e[a]]=t[a];return s}function E(e,t,i=1){let s=i||1,a=Math.abs(Math.floor((t-e)/s))+1;return[...Array(a).keys()].map((t=>t*i+e))}function A(e,t="public"){e%=1440;let i=parseInt(e/60);e%=60;let s=g();return s.setHours(i,e),x(s,t)}function x(e,t="public"){return m(e,"internal"==t?"H:i":"public"==t?h().settings().getTimeFormat():t)}function M(e){let t=e.split(":"),i=parseInt(t[0]),s=parseInt(t[1]),a=g();return a.setHours(i,s),a}function L(e){let t="";for(let i in e)t+=" "+i+'="'+e[i]+'"';return t}function B(e,t={}){return"<button"+L(t=jQuery.extend({},{type:"button",class:"button"},t))+">"+e+"</button>"}function V(e,t=""){return'<span class="'+`dashicons dashicons-${e} ${t}`.trimRight()+'"></span>'}function O(e,t){let i={service_id:".mpa-service-id",service_name:".mpa-service-name",service_thumbnail:".mpa-service-thumbnail",employee_id:".mpa-employee-id",employee_name:".mpa-employee-name",location_id:".mpa-location-id",location_name:".mpa-location-name",reservation_date:".mpa-reservation-date",reservation_save_date:".mpa-reservation-save-date",reservation_time:".mpa-reservation-time",reservation_period:".mpa-reservation-period",reservation_save_period:".mpa-reservation-save-period",reservation_capacity:".mpa-reservation-capacity",reservation_clients:".mpa-reservation-clients",reservation_clients_count:".mpa-reservation-clients-count",reservation_price:".mpa-reservation-price"},s=t.clone();s.attr("data-id",e.getItemId());let a=e.getCapacityOptions();for(let t in i){let r=i[t],n=s.find(r).first(),o="{"+t+"}";if(!(n.length>0?n.html():"").includes(o))continue;let l="";switch(t){case"service_id":l=e.service.id;break;case"service_name":l=e.service.name;break;case"service_thumbnail":l=U(e.service.thumbnail);break;case"employee_id":l=e.employee.id;break;case"employee_name":l=e.employee.name;break;case"location_id":l=e.location.id;break;case"location_name":l=e.location.name;break;case"reservation_date":l=m(e.date);break;case"reservation_save_date":l=m(e.date,"internal");break;case"reservation_time":l=e.time.toString("short");break;case"reservation_period":l=e.time.toString();break;case"reservation_save_period":l=e.time.toString("internal");break;case"reservation_capacity":l=j(D(a,a),e.capacity);break;case"reservation_clients":l=H(D(a,a),e.capacity);break;case"reservation_clients_count":l=e.capacity;break;case"reservation_price":let t=e.employee.id;l=F(e.service.getPrice(t,e.capacity))}n.html(n.html().replace(o,l))}return s.find(".cell-people .cell-title").html(e.getService().getQuantityLabel()),s.find('[name*="{item_id}"]').each(((t,i)=>{i.name=i.name.replace("{item_id}",e.getItemId())})),1===a.length&&s.find(".cell-people").addClass("mpa-hide"),s}function R(e,t,i="public"){let s="short"==i?"public":i,a=m(e,s),r=m(t,s);return"short"==i&&a==r?a:a+" - "+r}function F(e,t={}){let i=h().settings();t=jQuery.extend({currency_symbol:i.getCurrencySymbol(),currency_position:i.getCurrencyPosition(),decimal_separator:i.getDecimalSeparator(),thousand_separator:i.getThousandSeparator(),decimals:i.getDecimalsCount(),literal_free:!0,trim_zeros:!0},t);let s=function(e,t=0,i=".",s=","){let a,r,n,o,l,h="";return e<0&&(h="-",e*=-1),a=parseInt(e=(+e||0).toFixed(t))+"",(r=a.length)>3?r%=3:r=0,l=r?a.substr(0,r)+s:"",n=a.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+s),o=t?i+Math.abs(e-a).toFixed(t).replace(/-/,0).slice(2):"",h+l+n+o}(Math.abs(e),t.decimals,t.decimal_separator,t.thousand_separator),a="mpa-price";if(0==e&&(a+=" mpa-zero-price"),0==e&&t.literal_free)a+=" mpa-price-free",s=d("Free","Zero price","motopress-appointment");else{t.trim_zeros&&(s=function(e,t=null){null==t&&(t=h().settings().getDecimalSeparator());let i=new RegExp("\\"+t+"0+$");return e.replace(i,"")}(s));let i='<span class="mpa-currency">'+t.currency_symbol+"</span>";switch(t.currency_position){case"before":s=i+s;break;case"after":s+=i;break;case"before_with_space":s=i+"&nbsp;"+s;break;case"after_with_space":s=s+"&nbsp;"+i}e<0&&(s="-"+s)}return'<span class="'+a+'">'+s+"</span>"}function j(e,t,i={}){let s="<select"+L(i)+">";return s+=H(e,t),s+="</select>",s}function N(e,t,i=!1){let s="";return s='<option value="'+e+'"'+(i?' selected="selected"':"")+">",s+=t,s+="</option>",s}function H(e,t){let i="";for(let s in e)i+=N(s,e[s],s==t);return i}function Q(e,t,i,s){let a=H(t,s)+H(i,s);e.empty().append(a).val(s)}function U(e){let{width:t,height:i}=h().settings().getThumbnailSize();return"<img"+L({width:t,height:i,src:e,class:"attachment-thumbnail size-thumbnail"})+">"}class W extends s{constructor(e){super(e),this.setupProperties(),this.addListeners()}setupProperties(){this.$table=this.$element.find("table"),this.$rows=this.$table.children("tbody"),this.$addButton=this.$element.find(".mpa-add-button"),this.baseName=this.$element.attr("data-base-name"),this.rows={},this.rowsCount=0,this.$element.find(".mpa-attribute").each(((e,t)=>{let i=jQuery(t),s=i.attr("data-id");this.rows[s]=i,this.rowsCount++}))}addListeners(){let e=this;this.$addButton.on("click",(()=>{this.addRow()})),this.$element.find(".mpa-remove-button").on("click",(function(){e.removeRowByElement(this)}))}addRow(){let e=C(),t=this.renderRow(e);this.$rows.append(t);let i=this.$rows.find('[data-id="'+e+'"]');this.rows[e]=i,this.rowsCount++,this.$table.removeClass("mpa-hide");let s=this;i.find(".mpa-remove-button").on("click",(function(){s.removeRowByElement(this)}))}renderRow(e){let t=this.baseName+"["+e+"]",i="";return i+='<tr class="mpa-attribute" data-id="'+e+'">',i+='<td class="column-label">',i+='<input type="text" name="'+t+'[label]" value="" class="large-text">',i+="</td>",i+='<td class="column-content">',i+='<input type="text" name="'+t+'[content]" value="" class="large-text">',i+="</td>",i+='<td class="column-link">',i+='<input type="text" name="'+t+'[link]" value="" class="large-text">',i+="</td>",i+='<td class="column-class">',i+='<input type="text" name="'+t+'[class]" value="" class="large-text">',i+="</td>",i+='<td class="column-actions">'+V("trash","mpa-remove-button")+"</td>",i+="</tr>",i}removeRowByElement(e){let t=jQuery(e).parents(".mpa-attribute").attr("data-id");t&&this.removeRow(t)}removeRow(e){this.rows.hasOwnProperty(e)&&(this.rows[e].remove(),this.rowsCount--,delete this.rows[e],0==this.rowsCount&&this.$table.addClass("mpa-hide"))}}class z extends s{constructor(e){super(e),this.$table=this.$element.children("table"),this.$tableBody=this.$table.children("tbody"),this.$noItemsRow=this.$tableBody.children(".no-items"),this.$newPeriodRow=this.$tableBody.children(".mpa-new-period"),this.timeSelects=this.$newPeriodRow.find(".mpa-period"),this.$startTimeHoursInput=this.$newPeriodRow.find(".mpa-period__start-hours"),this.$startTimeMinutesInput=this.$newPeriodRow.find(".mpa-period__start-minutes"),this.$endTimeHoursInput=this.$newPeriodRow.find(".mpa-period__end-hours"),this.$endTimeMinutesInput=this.$newPeriodRow.find(".mpa-period__end-minutes"),this.$timeAllDayInput=this.$newPeriodRow.find(".mpa-period__all-day"),this.baseName=this.$element.attr("data-base-name"),this.datepicker=null,this.periods={length:0,add:function(e,t){let i=null==this[e];this[e]=t,i&&this.length++},remove:function(e){null!=this[e]&&(delete this[e],this.length--)},hasItems:function(){return this.length>0}},this.parseInitialState(),this.addListeners()}parseInitialState(){this.$tableBody.children(":not(.no-items, .mpa-new-period)").each(((e,t)=>{let i=t.getAttribute("data-id"),s=jQuery(t).find(".column-actions > input").val();this.periods.add(i,s)}))}initDatepicker(){this.datepicker=v(this.$tableBody.find(".mpa-new-period > .column-dates > input"),{mode:"range"})}addListeners(){this.$timeAllDayInput.on("change",(e=>{e.target.checked?this.timeSelects.hide():this.timeSelects.show()})),this.$table.find("thead .mpa-add-button").on("click",(()=>{this.toggleEdit()})),this.$tableBody.find(".mpa-add-button").on("click",(()=>{this.onAdd()}));let e=this;this.$tableBody.find(".mpa-remove-button").on("click",(function(){e.removePeriodByParent(this)}))}toggleEdit(){this.$newPeriodRow.hasClass("mpa-hide")?(this.$newPeriodRow.removeClass("mpa-hide"),null==this.datepicker?this.initDatepicker():this.datepicker.clear()):this.$newPeriodRow.addClass("mpa-hide")}addPeriod(e,t,i,s){let a=e+", "+t,r=C(),n=this.renderPeriod(r,e,t,i,s);jQuery(n).insertAfter(this.$newPeriodRow),this.periods.add(r,a);let o=this.$tableBody.find('[data-id="'+r+'"] .mpa-remove-button'),l=this;o.on("click",(function(){l.removePeriodByParent(this)})),this.toggleEdit(),this.$noItemsRow.addClass("mpa-hide")}renderPeriod(e,t,i,s,a){let r=t+", "+i,n="";return n+='<tr class="mpa-period" data-id="'+e+'">',n+='<td class="column-dates mpa-badge-new">',n+=s,n+="</td>",n+='<td class="column-time mpa-badge-new">',n+=a,n+="</td>",n+='<td class="column-actions">',n+='<input type="hidden" name="'+this.baseName+'[]" value="'+r+'">',n+=B(c("Remove","motopress-appointment"),{class:"button button-secondary mpa-remove-button"}),n+="</td>",n+="</tr>",n}getStartTime(){let e=0;return this.$timeAllDayInput.prop("checked")||(e=60*parseInt(this.$startTimeHoursInput.val())+parseInt(this.$startTimeMinutesInput.val())),e}getEndTime(){let e=0;return this.$timeAllDayInput.prop("checked")||(e=60*parseInt(this.$endTimeHoursInput.val())+parseInt(this.$endTimeMinutesInput.val())),e}onAdd(){let e=this.getStartTime(),t=this.getEndTime();if(!(this.datepicker.selectedDates.length>=2)||e===t&&0!==t||e>t&&0!==t)return;let i=this.datepicker.selectedDates[0],s=this.datepicker.selectedDates[1],a=m(i,"internal")+" - "+m(s,"internal"),r=R(i,s,"short"),n=A(e,"internal")+" - "+A(t,"internal"),o=A(e)+" - "+A(t);0===e&&0===e&&e===t&&(o=c("All day","motopress-appointment")),this.addPeriod(a,n,r,o)}removePeriodByParent(e){let t=jQuery(e).parents("tr.mpa-period");if(0==t.length)return;let i=t.attr("data-id");this.periods.remove(i),this.periods.hasItems()||this.$noItemsRow.removeClass("mpa-hide"),t.remove()}}class K extends s{constructor(e){super(e),this.$table=this.$element.children("table"),this.$tableBody=this.$table.children("tbody"),this.$noItemsRow=this.$tableBody.children(".no-items"),this.$newPeriodRow=this.$tableBody.children(".mpa-new-period"),this.baseName=this.$element.attr("data-base-name"),this.datepicker=null,this.periods={length:0,add:function(e,t){let i=null==this[e];this[e]=t,i&&this.length++},remove:function(e){null!=this[e]&&(delete this[e],this.length--)},hasItems:function(){return this.length>0}},this.parseInitialState(),this.addListeners()}parseInitialState(){this.$tableBody.children(":not(.no-items, .mpa-new-period)").each(((e,t)=>{let i=t.getAttribute("data-id"),s=jQuery(t).find(".column-actions > input").val();this.periods.add(i,s)}))}initDatepicker(){this.datepicker=v(this.$tableBody.find(".mpa-new-period > .column-dates > input"),{mode:"range",showMonths:2})}addListeners(){let e=this;this.$table.find("thead .mpa-add-button").on("click",(()=>{this.toggleEdit()})),this.$tableBody.find(".mpa-add-button").on("click",(()=>{this.onAdd()})),this.$tableBody.find(".mpa-remove-button").on("click",(function(){e.removePeriodByParent(this)}))}toggleEdit(){this.$newPeriodRow.hasClass("mpa-hide")?(this.$newPeriodRow.removeClass("mpa-hide"),null==this.datepicker?this.initDatepicker():this.datepicker.clear()):this.$newPeriodRow.addClass("mpa-hide")}addPeriod(e,t){let i=C(),s=this.renderPeriod(i,e,t);jQuery(s).insertAfter(this.$newPeriodRow),this.periods.add(i,e);let a=this.$tableBody.find('[data-id="'+i+'"] .mpa-remove-button'),r=this;a.on("click",(function(){r.removePeriodByParent(this)})),this.toggleEdit(),this.$noItemsRow.addClass("mpa-hide")}renderPeriod(e,t,i){let s="";return s+='<tr class="mpa-period" data-id="'+e+'">',s+='<td class="column-dates mpa-badge-new">',s+=i,s+="</td>",s+='<td class="column-actions">',s+='<input type="hidden" name="'+this.baseName+'[]" value="'+t+'">',s+=B(c("Remove","motopress-appointment"),{class:"button button-secondary mpa-remove-button"}),s+="</td>",s+="</tr>",s}onAdd(){if(this.datepicker.selectedDates.length<2)return;let e=this.datepicker.selectedDates[0],t=this.datepicker.selectedDates[1],i=m(e,"internal")+" - "+m(t,"internal"),s=R(e,t,"short");this.addPeriod(i,s)}removePeriodByParent(e){let t=jQuery(e).parents("tr.mpa-period");if(0==t.length)return;let i=t.attr("data-id");this.periods.remove(i),this.periods.hasItems()||this.$noItemsRow.removeClass("mpa-hide"),t.remove()}}function Y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var q,J,G={exports:{}},Z={exports:{}};q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",J={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&J.rotl(e,8)|4278255360&J.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=J.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],i=0,s=0;i<e.length;i++,s+=8)t[s>>>5]|=e[i]<<24-s%32;return t},wordsToBytes:function(e){for(var t=[],i=0;i<32*e.length;i+=8)t.push(e[i>>>5]>>>24-i%32&255);return t},bytesToHex:function(e){for(var t=[],i=0;i<e.length;i++)t.push((e[i]>>>4).toString(16)),t.push((15&e[i]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],i=0;i<e.length;i+=2)t.push(parseInt(e.substr(i,2),16));return t},bytesToBase64:function(e){for(var t=[],i=0;i<e.length;i+=3)for(var s=e[i]<<16|e[i+1]<<8|e[i+2],a=0;a<4;a++)8*i+6*a<=8*e.length?t.push(q.charAt(s>>>6*(3-a)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],i=0,s=0;i<e.length;s=++i%4)0!=s&&t.push((q.indexOf(e.charAt(i-1))&Math.pow(2,-2*s+8)-1)<<2*s|q.indexOf(e.charAt(i))>>>6-2*s);return t}},Z.exports=J;var X=Z.exports,ee={utf8:{stringToBytes:function(e){return ee.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(ee.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));return t},bytesToString:function(e){for(var t=[],i=0;i<e.length;i++)t.push(String.fromCharCode(e[i]));return t.join("")}}},te=ee,ie=function(e){return null!=e&&(se(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&se(e.slice(0,0))}(e)||!!e._isBuffer)};function se(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}!function(){var e=X,t=te.utf8,i=ie,s=te.bin,a=function(r,n){r.constructor==String?r=n&&"binary"===n.encoding?s.stringToBytes(r):t.stringToBytes(r):i(r)?r=Array.prototype.slice.call(r,0):Array.isArray(r)||r.constructor===Uint8Array||(r=r.toString());for(var o=e.bytesToWords(r),l=8*r.length,h=1732584193,c=-271733879,d=-1732584194,p=271733878,u=0;u<o.length;u++)o[u]=16711935&(o[u]<<8|o[u]>>>24)|4278255360&(o[u]<<24|o[u]>>>8);o[l>>>5]|=128<<l%32,o[14+(l+64>>>9<<4)]=l;var m=a._ff,y=a._gg,g=a._hh,v=a._ii;for(u=0;u<o.length;u+=16){var f=h,b=c,S=d,$=p;h=m(h,c,d,p,o[u+0],7,-680876936),p=m(p,h,c,d,o[u+1],12,-389564586),d=m(d,p,h,c,o[u+2],17,606105819),c=m(c,d,p,h,o[u+3],22,-1044525330),h=m(h,c,d,p,o[u+4],7,-176418897),p=m(p,h,c,d,o[u+5],12,1200080426),d=m(d,p,h,c,o[u+6],17,-1473231341),c=m(c,d,p,h,o[u+7],22,-45705983),h=m(h,c,d,p,o[u+8],7,1770035416),p=m(p,h,c,d,o[u+9],12,-1958414417),d=m(d,p,h,c,o[u+10],17,-42063),c=m(c,d,p,h,o[u+11],22,-1990404162),h=m(h,c,d,p,o[u+12],7,1804603682),p=m(p,h,c,d,o[u+13],12,-40341101),d=m(d,p,h,c,o[u+14],17,-1502002290),h=y(h,c=m(c,d,p,h,o[u+15],22,1236535329),d,p,o[u+1],5,-165796510),p=y(p,h,c,d,o[u+6],9,-1069501632),d=y(d,p,h,c,o[u+11],14,643717713),c=y(c,d,p,h,o[u+0],20,-373897302),h=y(h,c,d,p,o[u+5],5,-701558691),p=y(p,h,c,d,o[u+10],9,38016083),d=y(d,p,h,c,o[u+15],14,-660478335),c=y(c,d,p,h,o[u+4],20,-405537848),h=y(h,c,d,p,o[u+9],5,568446438),p=y(p,h,c,d,o[u+14],9,-1019803690),d=y(d,p,h,c,o[u+3],14,-187363961),c=y(c,d,p,h,o[u+8],20,1163531501),h=y(h,c,d,p,o[u+13],5,-1444681467),p=y(p,h,c,d,o[u+2],9,-51403784),d=y(d,p,h,c,o[u+7],14,1735328473),h=g(h,c=y(c,d,p,h,o[u+12],20,-1926607734),d,p,o[u+5],4,-378558),p=g(p,h,c,d,o[u+8],11,-2022574463),d=g(d,p,h,c,o[u+11],16,1839030562),c=g(c,d,p,h,o[u+14],23,-35309556),h=g(h,c,d,p,o[u+1],4,-1530992060),p=g(p,h,c,d,o[u+4],11,1272893353),d=g(d,p,h,c,o[u+7],16,-155497632),c=g(c,d,p,h,o[u+10],23,-1094730640),h=g(h,c,d,p,o[u+13],4,681279174),p=g(p,h,c,d,o[u+0],11,-358537222),d=g(d,p,h,c,o[u+3],16,-722521979),c=g(c,d,p,h,o[u+6],23,76029189),h=g(h,c,d,p,o[u+9],4,-640364487),p=g(p,h,c,d,o[u+12],11,-421815835),d=g(d,p,h,c,o[u+15],16,530742520),h=v(h,c=g(c,d,p,h,o[u+2],23,-995338651),d,p,o[u+0],6,-198630844),p=v(p,h,c,d,o[u+7],10,1126891415),d=v(d,p,h,c,o[u+14],15,-1416354905),c=v(c,d,p,h,o[u+5],21,-57434055),h=v(h,c,d,p,o[u+12],6,1700485571),p=v(p,h,c,d,o[u+3],10,-1894986606),d=v(d,p,h,c,o[u+10],15,-1051523),c=v(c,d,p,h,o[u+1],21,-2054922799),h=v(h,c,d,p,o[u+8],6,1873313359),p=v(p,h,c,d,o[u+15],10,-30611744),d=v(d,p,h,c,o[u+6],15,-1560198380),c=v(c,d,p,h,o[u+13],21,1309151649),h=v(h,c,d,p,o[u+4],6,-145523070),p=v(p,h,c,d,o[u+11],10,-1120210379),d=v(d,p,h,c,o[u+2],15,718787259),c=v(c,d,p,h,o[u+9],21,-343485551),h=h+f>>>0,c=c+b>>>0,d=d+S>>>0,p=p+$>>>0}return e.endian([h,c,d,p])};a._ff=function(e,t,i,s,a,r,n){var o=e+(t&i|~t&s)+(a>>>0)+n;return(o<<r|o>>>32-r)+t},a._gg=function(e,t,i,s,a,r,n){var o=e+(t&s|i&~s)+(a>>>0)+n;return(o<<r|o>>>32-r)+t},a._hh=function(e,t,i,s,a,r,n){var o=e+(t^i^s)+(a>>>0)+n;return(o<<r|o>>>32-r)+t},a._ii=function(e,t,i,s,a,r,n){var o=e+(i^(t|~s))+(a>>>0)+n;return(o<<r|o>>>32-r)+t},a._blocksize=16,a._digestsize=16,G.exports=function(t,i){if(null==t)throw new Error("Illegal argument "+t);var r=e.wordsToBytes(a(t,i));return i&&i.asBytes?r:i&&i.asString?s.bytesToString(r):e.bytesToHex(r)}}();var ae=Y(G.exports);class re{setupProperties(){this.itemId="",this.service=null,this.serviceCategories={},this.employee=null,this.location=null,this.date=null,this.time=null,this.capacity=1,this.availableEmployees=[],this.availableLocations=[],this.bookingVariants=[]}constructor(e){this.setupProperties(),this.itemId=e}getDate(){return this.date}getTime(){return this.time}getItemId(){return this.itemId}getAvailableEmployeeIds(){return this.availableEmployees.map((e=>e.id))}getAvailableLocationIds(){return this.availableLocations.map((e=>e.id))}getAvailableIds(){return{service_id:null!==this.service?this.service.id:0,employee_id:null!==this.employee?this.employee.id:0,employee_ids:this.getAvailableEmployeeIds(),location_ids:this.getAvailableLocationIds()}}getIds(){return{service_id:null!==this.service?this.service.id:0,employee_id:null!==this.employee?this.employee.id:0,location_id:null!==this.location?this.location.id:0}}toArray(e="all"){return"ids"===e?this.getIds():"availability"===e?this.getAvailableIds():"period"===e?{date:null!==this.date?m(this.date,"internal"):"",time:null!==this.time?this.time.toString("internal"):""}:jQuery.extend(this.getIds(),{date:null!==this.date?m(this.date,"internal"):"",time:null!==this.time?this.time.toString("internal"):"",capacity:this.capacity})}isSet(e="all"){let t=!0;return"all"!==e&&"ids"!==e||(t=t&&null!==this.service&&null!==this.employee&&null!==this.location),"all"!==e&&"period"!==e||(t=t&&null!==this.date&&null!==this.time),t}isAtTime(e,t){return null!==this.date&&null!==this.time&&m(this.date,"internal")==m(e,"internal")&&this.time.toString("internal")==t.toString("internal")}getCapacity(){return this.capacity}getMinCapacity(){return null!==this.service?this.service.getMinCapacity(this.getEmployeeId()):1}getMaxCapacity(){return null!==this.service?this.service.getMaxCapacity(this.getEmployeeId()):1}getMinPossibleCapacity(){if(null===this.service)return 1;{let e=this.getMaxCapacity();for(let t of this.bookingVariants)e=Math.min(e,t.minCapacity);return e}}getMaxPossibleCapacity(){if(null===this.service)return 1;{let e=this.getMinCapacity();for(let t of this.bookingVariants)e=Math.max(e,t.maxCapacity);return e}}getCapacityOptions(){if(null===this.service)return[1];{let e=[];for(let t of this.bookingVariants)e=e.concat(E(t.minCapacity,t.maxCapacity));return k(e)}}getPrice(){if(!this.service)return 0;let e=this.employee?this.employee.id:0;return this.service.getPrice(e,this.capacity)}getDeposit(e){let t=0;switch(this.service.depositType){case"disabled":default:t=e;break;case"fixed":t=this.service.depositAmount;break;case"percentage":t=e*this.service.depositAmount/100}return t>e?e:t}getHash(e="all"){return ae(JSON.stringify(this.toArray(e)))}didChange(e,t="all"){return e!==this.getHash(t)}getEmployeeId(){return this.employee?this.employee.getId():0}getEmployee(e){if(null!==this.employee&&this.employee.getId()==e)return this.employee;for(let t of this.availableEmployees)if(t.id==e)return t;return null}getLocationId(){return this.location?this.location.getId():0}getLocation(e){if(null!==this.location&&this.location.id==e)return this.location;for(let t of this.availableLocations)if(t.id==e)return t;return null}getService(){return this.service}hasMultipleAvailableEmployees(){return this.availableEmployees.length>1}hasMultipleAvailableLocations(){return this.availableLocations.length>1}hasMultipleAvailableVariants(){return this.hasMultipleAvailableEmployees()||this.hasMultipleAvailableLocations()}setService(e){this.service=e}setServiceCategories(e){this.serviceCategories=e}setEmployee(e,t=!0){"number"==typeof e&&(e=this.getEmployee(e)),this.employee=e,!0===t&&(this.availableEmployees=[e])}setAvailableEmployees(e,t=!0){this.availableEmployees=e,!0===t&&(this.employee=null)}setLocation(e,t=!0){"number"==typeof e&&(e=this.getLocation(e)),this.location=e,!0===t&&(this.availableLocations=[e])}setAvailableLocations(e,t=!0){this.availableLocations=e,!0===t&&(this.location=null)}setCapacity(e){this.capacity=e}setBookingVariants(e){this.bookingVariants=[];for(let t of e)this.bookingVariants.push({employeeId:t[0],locationId:t[1],minCapacity:t[2],maxCapacity:t[3]})}getBookingVariantForCapacity(e){for(let t of this.bookingVariants)if(e>=t.minCapacity&&e<=t.maxCapacity)return t;return{employeeId:this.getEmployeeId(),locationId:this.getLocationId(),minCapacity:this.getMinCapacity(),maxCapacity:this.getMaxCapacity()}}removeBookingVariatForEmployee(e){for(let t in this.bookingVariants){this.bookingVariants[t].employeeId==e&&this.bookingVariants.splice(t,1)}}}class ne{constructor(e=null){this.setupProperties(),null!=e&&this.merge(e)}setupProperties(){this.keys=[],this.values={},this.length=0}merge(e){for(let t in e)this.push(t,e[t])}push(e,t){let i=!this.includesKey(e);return this.values[e]=t,i&&(this.keys.push(e),this.length++),i}find(e,t=null){return this.includesKey(e)?this.values[e]:t}findNext(e,t=null){let i=this.findNextKey(e);return""!==i?this.values[i]:t}findNextKey(e){let t=this.keys.indexOf(e);if(-1===t)return"";let i=t+1;return i<this.length?this.keys[i]:this.keys[t]}findPrevious(e,t=null){let i=this.findPreviousKey(e);return""!==i?this.values[i]:t}findPreviousKey(e){let t=this.keys.indexOf(e);if(-1===t)return"";let i=t-1;return i>=0?this.keys[i]:this.keys[t]}update(e,t){return this.push(e,t)}remove(e){if(!this.includesKey(e))return null;let t=this.values[e];delete this.values[e];let i=this.keys.indexOf(e);return this.keys.splice(i,1),this.length--,t}empty(){return this.keys=[],this.values={},this.length=0,this}isEmpty(){return 0==this.length}includesKey(e){return e in this.values}firstKey(){return this.keys.length>0?this.keys[0]:null}firstValue(){let e=this.firstKey();return null!==e?this.values[e]:null}lastValue(){let e=this.lastKey();return null!=e?this.values[e]:null}lastKey(){return this.isEmpty()?null:this.keys[this.length-1]}cloneKeys(){return[...this.keys]}getColumn(e){let t=[];for(let i of this.keys){let s=this.values[i][e];null!=s&&(Array.isArray(s)?t=t.concat(s):t.push(s))}return k(t)}forEach(e){let t=0;for(let i of this.keys){let s=e(this.values[i],t,i,this);if(t++,!1===s)break}}map(e){let t=[],i=0;for(let s of this.keys)t.push(e(this.values[s],i,s,this)),i++;return t}toArray(){let e=[];for(let t of this.keys)e.push(this.values[t]);return e}getLength(){return this.length}}class oe{setupProperties(){this.items=new ne,this.activeItem=null,this.customerDetails={name:"",email:"",phone:""},this.paymentDetails={booking_id:0,gateway_id:"none"},this.coupon=null}constructor(){this.setupProperties()}createItem(e=""){e||(e=C());let t=new re(e);return this.items.push(e,t),this.activeItem=t,t}getItem(e){return this.items.find(e)}getActiveItem(){return this.activeItem}getActiveItemId(){return null!==this.activeItem?this.activeItem.getItemId():""}getItems(){return this.items}getItemsCount(){return this.items.getLength()}setActiveItem(e){this.activeItem="string"==typeof e?this.getItem(e):e}removeItem(e){"string"==typeof e?this.items.remove(e):this.items.remove(e.getItemId())}isEmpty(){return 0===this.getItemsCount()}getProducts(){let e=[];return this.items.forEach((t=>{null!=t.service&&e.push({name:t.service.name,price:t.getPrice(),capacity:t.getCapacity(),quantity_label:t.getService().getQuantityLabel()})})),e}getSubtotalPrice(e=null){null===e&&(e=this.getProducts());let t=0;for(let i of e)t+=i.price;return t}getTotalPrice(e=null){let t=this.getSubtotalPrice(e);if(this.hasCoupon()){let e=this.coupon.calcDiscountAmount(this);return Math.max(0,t-e)}return t}getDeposit(){let e=0;return this.items.forEach((t=>{let i=t.getPrice();this.hasCoupon()&&(i-=this.coupon.calcDiscountForCartItem(t)),e+=t.getDeposit(i)})),e}getCustomer(){return this.customerDetails}getOrder(){let e=this.getProducts(),t={products:e,subtotal:this.getSubtotalPrice(e),total:this.getTotalPrice(e),customer:this.getCustomer()};return this.hasCoupon()&&(t.coupon={code:this.coupon.getCode(),amount:this.coupon.calcDiscountAmount(this)}),t.deposit=this.getDeposit(),t}getPaymentDetails(){return this.paymentDetails}toArray(e="all"){let t={items:[],customer:this.customerDetails};return this.items.forEach((e=>{e.isSet()&&t.items.push(e.toArray())})),h().settings().isPaymentsEnabled()&&(t.payment_details=this.paymentDetails),this.hasCoupon()&&(t.coupon=this.coupon.getCode()),"items"===e?t.items:t}getHash(e="all"){return ae("order"!==e?JSON.stringify(this.toArray(e)):JSON.stringify(this.getOrder()))}didChange(e,t="all"){return e!==this.getHash(t)}setCustomerDetails(e){jQuery.extend(this.customerDetails,e)}setPaymentDetails(e){jQuery.extend(this.paymentDetails,e)}reset(){this.setupProperties()}getMinDate(){let e=null;return this.items.forEach((t=>{t.date&&(!e||e>t.date)&&(e=new Date(t.date.getTime()))})),e||g()}getServiceIds(){let e=this.items.map((e=>null!=e.service?e.service.id:0));return e=k(e),e}updateServices(e){for(let t of e)this.items.forEach((e=>{null!=e.service&&e.service.id===t.id&&(e.service=t)}))}setCoupon(e){this.coupon=e}removeCoupon(){this.coupon=null}hasCoupon(){return null!=this.coupon}testCoupon(){this.hasCoupon()&&!this.coupon.isApplicableForCart(this)&&this.removeCoupon()}}class le{constructor(e,t={}){this.id=e,this.setupProperties(),this.setupValues(t)}setupProperties(){}setupValues(e){for(let t in e)this[t]=e[t]}getId(){return this.id}}class he extends le{setupProperties(){super.setupProperties(),this.name=""}}class ce extends le{setupProperties(){super.setupProperties(),this.name=""}}class de extends le{setupProperties(){super.setupProperties(),this.name="",this.price=0,this.depositType="disabled",this.depositAmount=0,this.duration=0,this.bufferTimeBefore=0,this.bufferTimeAfter=0,this.timeBeforeBooking="",this.maxAdvanceTimeBeforeReservation="",this.minCapacity=1,this.maxCapacity=1,this.multiplyPrice=!1,this.isGroupServiceEnabled=!1,this.customQuantityLabel="",this.variations={},this.image="",this.thumbnail=""}getName(){return this.name}getPrice(e=0,t=0){t||(t=this.minCapacity);let i=this.getVariation("price",e,this.price);return this.multiplyPrice&&(i*=t),i}getDuration(e=0){return this.getVariation("duration",e,this.duration)}getMinCapacity(e=0){return this.getVariation("min_capacity",e,this.minCapacity)}getMaxCapacity(e=0){return this.getVariation("max_capacity",e,this.maxCapacity)}getVariation(e,t,i){return t in this.variations?this.variations[t][e]:i}setName(e){this.name=e}isGroupService(){return this.isGroupServiceEnabled}getCustomQuantityLabel(){return this.customQuantityLabel}getQuantityLabel(){return""!==this.customQuantityLabel?this.getCustomQuantityLabel():c("Clients","motopress-appointment")}}class pe{static loadInBackground(e,t,i=!1){return t.findById(e.id,i).then((t=>{if(null!==t)for(let i in t)e[i]=t[i];return t}))}}class ue extends le{setupProperties(){super.setupProperties(),this.status="new",this.code="",this.description="",this.type="fixed",this.amount=0,this.expirationDate=null,this.serviceIds=[],this.minDate=null,this.maxDate=null,this.usageLimit=0,this.usageCount=0}setupValues(e){for(let t of["expirationDate","minDate","maxDate"]){let i=e[t];null!=i&&""!==i&&(this[t]=y(i)),delete e[t]}super.setupValues(e)}getCode(){return this.code}isApplicableForCart(e){let t=!1;return e.items.forEach((e=>{if(this.isApplicableForCartItem(e))return t=!0,!1})),t}isApplicableForCartItem(e){return!!e.isSet()&&(!(this.serviceIds.length>0&&-1==this.serviceIds.indexOf(e.service.id))&&(!(null!=this.minDate&&e.date<this.minDate)&&!(null!=this.maxDate&&e.date>this.maxDate)))}calcDiscountAmount(e){let t=this.calcDiscountForCart(e);return Math.min(t,e.getSubtotalPrice())}calcDiscountForCart(e){let t=0;return e.items.forEach((e=>{t+=this.calcDiscountForCartItem(e)})),t}calcDiscountForCartItem(e){let t=0;if(this.isApplicableForCartItem(e)){let i=e.getPrice();switch(this.type){case"fixed":t=this.amount;break;case"percentage":t=i*this.amount/100}t=Math.min(t,i)}return t}}class me{constructor(e){var t;this.postType=e,this.entityType=0===(t=e).indexOf("mpa_")?t.substring(4):0===t.indexOf("_mpa_")?t.substring(5):t,this.savedEntities={}}findById(e,t=!1){return e?!t&&this.haveEntity(e)&&null!=this.getEntity(e)?Promise.resolve(this.getEntity(e)):this.requestEntity(e).then((t=>{let i=this.mapRestDataToEntity(t);return this.saveEntity(e,i),i}),(t=>(this.saveEntity(e,null),null))):Promise.resolve(null)}findAll(e,t=!1){let i=[],s=[];for(let a of e)this.haveEntity(a)&&!t?s.push(this.getEntity(a)):i.push(a);return 0===i.length?Promise.resolve(s):this.requestEntities(i).then((e=>{for(let t of e){let e=this.mapRestDataToEntity(t);this.saveEntity(e.id,e),s.push(e)}return s}),(e=>[]))}requestEntity(e){return n(this.getRoute(),{id:e})}requestEntities(e){return n(this.getRoute(),{id:e})}haveEntity(e){return e in this.savedEntities}getEntity(e){return this.savedEntities[e]||null}saveEntity(e,t){this.savedEntities[e]=t}mapRestDataToEntity(e){return null}getRoute(){return`/${this.entityType}s`}}class ye extends me{findByCode(e,t=!1){return n(this.getRoute(),{code:e}).then((e=>{let t=this.mapRestDataToEntity(e);return this.saveEntity(t.getId(),t),t}),(e=>{if(t)return null;throw e}))}mapRestDataToEntity(e){return new ue(e.id,e)}}class ge{constructor(e,t=null){this.setupProperties(),null==t?this.parsePeriod(e):(this.setStartTime(e),this.setEndTime(t))}setupProperties(){this.startTime=null,this.endTime=null}parsePeriod(e){let t=e.split(" - ");this.setStartTime(t[0]),this.setEndTime(t[1])}setStartTime(e){this.startTime="string"==typeof e?M(e):new Date(e)}setEndTime(e){this.endTime="string"==typeof e?M(e):new Date(e),0===this.endTime.getHours()&&0===this.endTime.getMinutes()&&this.startTime.getFullYear()===this.endTime.getFullYear()&&this.startTime.getMonth()===this.endTime.getMonth()&&this.startTime.getDate()===this.endTime.getDate()&&this.endTime.setDate(this.endTime.getDate()+1)}setDate(e){this.startTime.setFullYear(e.getFullYear()),this.startTime.setMonth(e.getMonth(),e.getDate()),this.endTime.setFullYear(e.getFullYear()),this.endTime.setMonth(e.getMonth(),e.getDate()),0===this.endTime.getHours()&&0===this.endTime.getMinutes()&&this.startTime.getFullYear()===this.endTime.getFullYear()&&this.startTime.getMonth()===this.endTime.getMonth()&&this.startTime.getDate()===this.endTime.getDate()&&this.endTime.setDate(this.endTime.getDate()+1)}intersectsWith(e){return this.startTime<e.endTime&&this.endTime>e.startTime}isSubperiodOf(e){return this.startTime>=e.startTime&&this.endTime<=e.endTime}mergePeriod(e){this.startTime.setTime(Math.min(this.startTime.getTime(),e.startTime.getTime())),this.endTime.setTime(Math.max(this.endTime.getTime(),e.endTime.getTime()))}diffPeriod(e){this.startTime<e.startTime?this.endTime.setTime(Math.min(e.startTime.getTime(),this.endTime.getTime())):this.startTime.setTime(Math.max(e.endTime.getTime(),this.startTime.getTime()))}splitByPeriod(e){let t=[];return e.startTime.getTime()-this.startTime.getTime()>0&&t.push(new ge(this.startTime,e.startTime)),this.endTime.getTime()-e.endTime.getTime()>0&&t.push(new ge(e.endTime,this.endTime)),t}isEmpty(){return this.endTime.getTime()-this.startTime.getTime()<=0}toString(e="public",t=" - "){"internal"==e&&(t=" - ");let i="short"==e?"public":e,s=x(this.startTime,i),a=x(this.endTime,i);return"internal"!==e&&0===this.startTime.getHours()&&0===this.startTime.getMinutes()&&s===a?c("All day","motopress-appointment"):"short"==e&&s==a?s:s+t+a}}class ve extends le{setupProperties(){super.setupProperties(),this.serviceId=0,this.date=null,this.serviceTime=null,this.bufferTime=null}setupValues(e){for(let t in e)"date"==t?this.setDate(e[t]):"serviceTime"==t?this.setServiceTime(e[t]):"bufferTime"==t?this.setBufferTime(e[t]):this[t]=e[t]}setDate(e){this.date="string"==typeof e?y(e):e,null!=this.serviceTime&&this.serviceTime.setDate(this.date),null!=this.bufferTime&&this.bufferTime.setDate(this.date)}setServiceTime(e){this.serviceTime="string"==typeof e?new ge(e):e,null!=this.date&&this.serviceTime.setDate(this.date)}setBufferTime(e){this.bufferTime="string"==typeof e?new ge(e):e,null!=this.date&&this.bufferTime.setDate(this.date)}}class fe extends me{findAllByService(e,t={}){let i={service_id:e};return null!=t.from_date&&(i.from_date=m(t.from_date,"internal")),null!=t.to_date&&(i.to_date=m(t.to_date,"internal")),n("/bookings/reservations",i).then((e=>{let t=[];for(let i of e){let e=this.mapRestDataToEntity(i);this.saveEntity(e.id,e),t.push(e)}return t})).catch((e=>(console.error("No reservations found.",e.message),[])))}mapRestDataToEntity(e){return new ve(e.id,e)}}class be{constructor(e,t=null){this.setupProperties(),null==t?this.parsePeriod(e):(this.setStartDate(e),this.setEndDate(t))}setupProperties(){this.startDate=null,this.endDate=null}parsePeriod(e){let t=e.split(" - ");this.setStartDate(t[0]),this.setEndDate(t[1])}setStartDate(e){this.startDate=this.convertToDate(e)}setEndDate(e){this.endDate=this.convertToDate(e)}convertToDate(e){return"string"==typeof e?y(e)||g():new Date(e)}calcDays(){let e=this.endDate.getTime()-this.startDate.getTime();return Math.round(e/1e3/3600/24)}inPeriod(e){return"string"==typeof e&&(e=y(e)),null!=e&&e>=this.startDate&&e<=this.endDate}splitToDates(){let e={};for(let t=new Date(this.startDate);t<=this.endDate;t.setDate(t.getDate()+1)){let i=m(t,"internal"),s=new Date(t);e[i]=s}return e}toString(){return m(this.startDate,"internal")+" - "+m(this.endDate,"internal")}}class Se extends le{setupProperties(){super.setupProperties(),this.timetable=[],this.workTimetable=[],this.customWorkdays=[],this.daysOff={}}setupValues(e){for(let t in e)"timetable"==t?this.setTimetable(e[t]):"customWorkdays"==t?this.setCustomWorkdays(e[t]):"daysOff"==t?this.setDaysOff(e[t]):this[t]=e[t]}setTimetable(e){this.timetable=[],this.workTimetable=[],e.forEach((e=>{let t=[],i=[];e.forEach((e=>{let s=new ge(e.time_period);t.push({time_period:s,location:e.location,activity:e.activity}),"work"==e.activity&&i.push({time_period:s,location:e.location})})),this.timetable.push(t),this.workTimetable.push(i)}))}setCustomWorkdays(e){this.customWorkdays=[];for(let t of e)this.customWorkdays.push({date_period:new be(t.date_period),time_period:new ge(t.time_period)})}setDaysOff(e){this.daysOff={};for(let t of e){let e=new be(t).splitToDates();jQuery.extend(this.daysOff,e)}}isDayOff(e){return"string"!=typeof e&&(e=m(e,"internal")),e in this.daysOff}getWorkingHours(e,t=0){if(this.isDayOff(e))return[];if("string"==typeof e&&(e=y(e)),null==e)return[];let i=[],s=e.getDay();for(let e of this.workTimetable[s])0!=t&&e.location!=t||i.push(e.time_period);for(let t of this.customWorkdays)t.date_period.inPeriod(e)&&i.push(t.time_period);return i}}class $e extends me{mapRestDataToEntity(e){return new Se(e.id,e)}}class we extends me{mapRestDataToEntity(e){return new de(e.id,e)}}class Ie{constructor(){this.repositories={}}schedule(){return null==this.repositories.schedule&&(this.repositories.schedule=new $e("mpa_schedule")),this.repositories.schedule}service(){return null==this.repositories.service&&(this.repositories.service=new we("mpa_service")),this.repositories.service}reservation(){return null==this.repositories.reservation&&(this.repositories.reservation=new fe("mpa_reservation")),this.repositories.reservation}coupon(){return null==this.repositories.coupon&&(this.repositories.coupon=new ye("mpa_coupon")),this.repositories.coupon}customer(){return void 0===this.repositories.customer&&(this.repositories.customer=new CustomerRepository),this.repositories.customer}static getInstance(){return null==Ie.instance&&(Ie.instance=new Ie),Ie.instance}}function Te(){return Ie.getInstance()}let _e=null;function Ce(e){return b(e)}class ke{setupProperties(){this.availability={},this.services={},this.serviceCategories={},this.employees={},this.locations={},this.servicePromise=null,this.readyPromise=null}constructor(){this.setupProperties()}load(e=!1){return this.readyPromise=function(e=!1){return(e||null==_e)&&(_e=n("/services/available").catch((e=>(console.error("Unable to extract available services."),{})))),_e}(e).then((e=>(this.setAvailability(e),this))),this.readyPromise}setAvailability(e){this.availability=e;for(let t in e){let i=e[t];this.services[t]=i.name;for(let e in i.categories){let t=i.categories[e];this.serviceCategories[e]=t}for(let e in i.employees){let t=i.employees[e];this.employees[e]=t.name;for(let e in t.locations){let i=t.locations[e];this.locations[e]=i}}}}isEmpty(){return _(this.availability)}ready(){return null===this.readyPromise&&this.load(),this.readyPromise}getServicePromise(){return this.servicePromise}getService(e,t=!0,i=null){let s=new de(e);return this.services.hasOwnProperty(e)&&s.setName(this.services[e]),!0===t?(this.servicePromise=pe.loadInBackground(s,Te().service()),null!==i&&this.servicePromise.then(i),this.servicePromise.then((()=>s))):this.servicePromise=null,s}getServiceCategories(e){return this.availability[e].categories}getEmployee(e){let t=new he(e);return this.employees.hasOwnProperty(e)&&(t.name=this.employees[e]),t}getLocation(e){let t=new ce(e);return this.locations.hasOwnProperty(e)&&(t.name=this.locations[e]),t}getAvailableServices(e="",t=0,i=0){let s={};for(let a in this.availability){let r=this.availability[a];if(""===e||e in r.categories){if(0!==t){let e=!1;if(Object.keys(r.employees).forEach((i=>{r.employees[i].locations.hasOwnProperty(t)&&(e=!0)})),!e)continue}(0===i||i in r.employees)&&(s[a]=r.name)}}return s}getAvailableServiceCategories(){let e={};for(let t in this.availability){let i=this.availability[t];jQuery.extend(e,i.categories)}return e}getAvailableEmployees(e=0,t=0){let i={};for(let s in this.availability){if(0!=e&&s!=e)continue;let a=this.availability[s];for(let e in a.employees){let s=a.employees[e];(0===t||t in s.locations)&&(i[e]=s.name)}}return i}getAvailableLocations(e=0,t=0){let i={};for(let s in this.availability){if(0!=e&&s!=e)continue;let a=this.availability[s];for(let e in a.employees){if(0!=t&&e!=t)continue;let s=a.employees[e];jQuery.extend(i,s.locations)}}return i}isAvailableServiceCategory(e){return this.getAvailableServiceCategories().hasOwnProperty(e)}isAvailableService(e){return this.getAvailableServices().hasOwnProperty(e)}isAvailableLocation(e){return this.getAvailableLocations().hasOwnProperty(e)}isAvailableEmployee(e){return this.getAvailableEmployees().hasOwnProperty(e)}filterAvailableEmployees(e,t=0,i="ids"){if(!(e in this.availability))return[];let s=[];Array.isArray(t)?s=t.filter(Ce):0!==t&&s.push(t);let a=[];for(let t in this.availability[e].employees){t=S(t);let i=this.availability[e].employees[t];if(0===s.length)a.push(t);else{P(s,Object.keys(i.locations).map(S)).length>0&&a.push(t)}}return 0===a.length?[]:"entities"===i?a.map((e=>this.getEmployee(e))):a}filterAvailableLocations(e,t=0,i="ids"){if(!(e in this.availability))return[];let s=[];Array.isArray(t)?s=t.filter(Ce):0!==t&&s.push(t);let a=[];for(t in this.availability[e].employees){if(t=S(t),s.length>0&&-1===s.indexOf(t))continue;let i=this.availability[e].employees[t];for(let e in i.locations)a.push(S(e))}return a=k(a),0===a.length?[]:"entities"===i?a.map((e=>this.getLocation(e))):a}}class Pe{constructor(e){this.cart=e,this.steps=new ne,this.currentStep=null,this.currentStepId=""}addStep(e){return this.steps.push(e.stepId,e),this}getStep(e){return this.steps.find(e)}mount(e){this.addListeners(e)}addListeners(e){e.children(".mpa-booking-step").on("mpa_booking_step_next",((e,t)=>this.onStep("next",t))).on("mpa_booking_step_back",((e,t)=>this.onStep("back",t))).on("mpa_booking_step_new",((e,t)=>this.onStep("new",t))).on("mpa_reset_booking",((e,t)=>this.onStep("reset",t)))}onStep(e,t){if(!t||!t.step||t.step===this.currentStepId)switch(e){case"next":this.goToNextStep();break;case"back":this.goToPreviousStep();break;case"new":this.goToFirstStep();break;case"reset":this.reset()}}goToNextStep(){if(this.steps.isEmpty())return;let e=this.currentStep?this.steps.findNextKey(this.currentStepId):this.steps.firstKey();e!==this.currentStepId&&(this.switchStep(e),this.skipNextHiddenSteps())}skipNextHiddenSteps(){null!==this.currentStep&&this.currentStep.ready().finally((()=>{this.currentStep.isHiddenStep&&this.currentStep.submit()}))}goToPreviousStep(){if(this.steps.isEmpty())return;let e=this.currentStep?this.steps.findPreviousKey(this.currentStepId):"";e&&e!==this.currentStepId&&(this.switchStep(e),this.skipPreviousHiddenSteps())}skipPreviousHiddenSteps(){null!==this.currentStep&&this.currentStep.ready().finally((()=>{this.currentStep.isHiddenStep&&this.currentStep.cancel()}))}goToFirstStep(){if(this.steps.isEmpty())return;this.cart.createItem(),this.steps.forEach((e=>{"cart item"===e.getCartContext()&&e.reset()}));let e=this.steps.firstKey();this.switchStep(e),this.skipNextHiddenSteps()}goToStep(e){this.switchStep(e)}getFirstVisibleStepId(){let e=null;return this.steps.forEach((t=>{if(!1===t.isHiddenStep)return e=t.stepId,!1})),e}isFirstVisibleStepId(e){return this.getFirstVisibleStepId()===e}switchStep(e){let t=this.steps.find(e);null!=t&&(this.isFirstVisibleStepId(e)&&t.hideButtonBack(),null!=this.currentStep&&this.currentStep.hide(),this.currentStep=t,this.currentStepId=e,t.load(),t.ready().finally((()=>t.show())))}reset(){this.cart.reset(),this.goToFirstStep(),this.steps.forEach((e=>{"cart item"!==e.getCartContext()&&e.reset()}))}}class De{constructor(e,t){this.$element=e,this.cart=t,this.setupProperties(),this.addListeners()}setupProperties(){this.stepId=this.theId(),this.schema=this.propertiesSchema(),this.isActive=!1,this.isLoaded=!1,this.isHiddenStep=!1,this.preventReact=!1,this.preventUpdate=!1,this.hideButtons=!1,this.readyPromise=null,this.$buttons=this.$element.find(".mpa-actions"),this.$buttonBack=this.$buttons.find(".mpa-button-back"),this.$buttonNext=this.$buttons.find(".mpa-button-next")}theId(){return"abstract"}getCartContext(){return"cart"}propertiesSchema(){return{}}addListeners(){this.$buttonBack.on("click",this.cancel.bind(this)),this.$buttonNext.on("click",this.submit.bind(this))}load(){this.isLoaded?this.readyPromise=this.reload():(this.readyPromise=this.loadEntities(),this.isLoaded=!0)}loadEntities(){return Promise.resolve(this)}reload(){return Promise.resolve(this)}reset(){}ready(){return this.readyPromise}isValidInput(){return!1}setProperty(e,t){if(this.preventUpdate)return;let i=this.validateProperty(e,t);if(i===this[e])return;let s=this.preventReact;this.preventReact=!0,this.updateProperty(e,i),s||(this.isActive&&this.react(),this.preventReact=!1)}resetProperty(e){this.setProperty(e)}validateProperty(e,t){let i=t;if(e in this.schema){let s=this.schema[e];if(null==t)i=s.default;else{switch(s.type){case"bool":i=b(t);break;case"integer":i=S(t)}if(!_(i)&&null!=s.options){s.options.indexOf(i)>=0||(i=this[e])}}}else null==t&&(i=null);return i}updateProperty(e,t){let i=this[e];this[e]=t,this.afterUpdate(e,t,i)}afterUpdate(e,t,i){}react(){let e=this.isValidInput();this.$buttonNext.prop("disabled",!e),this.hideButtons&&this.$buttons.toggleClass("mpa-hide",!e)}show(){this.enable(),this.react(),this.$element.removeClass("mpa-hide"),this.readyPromise.finally((()=>this.showReady()))}showReady(){this.$element.addClass("mpa-loaded"),this.hideButtons||this.$buttons.removeClass("mpa-hide")}hide(){this.disable(),this.$element.addClass("mpa-hide")}enable(){this.isActive=!0,this.$buttonBack.prop("disabled",!1),this.$buttonNext.prop("disabled",!1)}disable(){this.isActive=!1,this.$buttonBack.prop("disabled",!0),this.$buttonNext.prop("disabled",!0)}cancel(e){void 0!==e&&e.stopPropagation(),this.isActive&&(this.disable(),this.triggerBack())}submit(e){if(void 0!==e&&e.stopPropagation(),!this.isActive||!this.isValidInput())return;this.disable();let t=this.maybeSubmit();null==t?this.triggerNext():"object"!=typeof t?t?this.triggerNext():this.cancelSubmission():t.then(this.triggerNext.bind(this),this.cancelSubmission.bind(this))}maybeSubmit(){}cancelSubmission(){this.enable(),this.react()}triggerBack(){this.$element.trigger("mpa_booking_step_back",{step:this.stepId})}triggerNext(){this.$element.trigger("mpa_booking_step_next",{step:this.stepId})}hideButtonBack(){this.$buttonBack.prop("disabled",!0),this.$buttonBack.toggleClass("mpa-hide",!0)}}class Ee extends De{setupProperties(){super.setupProperties(),this.isBeginCheckoutEventSent=!1,this.$cart=this.$element.find(".mpa-cart"),this.$items=this.$cart.find(".mpa-cart-items"),this.$itemTemplate=this.$cart.find(".mpa-cart-item-template"),this.$noItems=this.$element.find(".no-items"),this.$totalPrice=this.$element.find(".mpa-cart-total-price"),this.$buttonNew=this.$buttons.find(".mpa-button-new")}theId(){return"cart"}addListeners(){super.addListeners(),this.$buttonNew.on("click",this.createNew.bind(this))}load(){if(this.$itemTemplate.remove(),this.$itemTemplate.removeClass("mpa-cart-item-template"),null!==this.cart.getActiveItem()){let e=this.cart.getActiveItem(),t=e.getItemId(),i=e.getDate(),s=e.getTime();this.cart.getItems().forEach((a=>{a.isSet()&&a.getItemId()!=t&&a.isAtTime(i,s)&&a.removeBookingVariatForEmployee(e.getEmployeeId())}))}this.updateActiveItemCapacity(),this.refreshCart(),this.isLoaded=!0,this.readyPromise=Promise.resolve(this)}reset(){this.$items.find(".mpa-cart-item").remove(),this.$noItems.removeClass("mpa-hide"),this.isBeginCheckoutEventSent=!1}updateActiveItemCapacity(){let e=this.cart.getActiveItem();if(!e)return;let t=e.getMinCapacity(),i=e.getMaxCapacity();var s,a,r;e.setCapacity((s=e.getCapacity(),a=t,r=i,Math.max(a,Math.min(s,r))))}refreshCart(){this.cart.getActiveItemId(),this.cart.items.forEach(((e,t,i)=>{let s='.mpa-cart-item[data-id="'+i+'"]',a=this.$items.find(s);0===a.length?(a=this.addItem(e),this.bindListeners(a)):(a=this.updateItem(a,e),this.bindListeners(a))})),this.updateTotalPrice()}addItem(e){let t=O(e,this.$itemTemplate);return this.$items.append(t),this.$noItems.addClass("mpa-hide"),t}updateItem(e,t){let i=O(t,this.$itemTemplate);return e.replaceWith(i),i}bindListeners(e){let t=e.data("id"),i=this.cart.getItem(t),s=e.find(".mpa-reservation-capacity select, .mpa-reservation-clients select"),a=e.find(".mpa-reservation-price"),r=e.find(".mpa-button-remove, .mpa-button-edit-or-remove"),n=e.find(".mpa-button-edit, .mpa-button-edit-or-remove");s.on("change",(t=>{let s=S(t.target.value);i.setCapacity(s);let r=i.getBookingVariantForCapacity(s),n=r.employeeId,o=r.locationId;if(i.getEmployeeId()!=n)i.setEmployee(n,!1),i.setLocation(o,!1),e=this.updateItem(e,i),this.bindListeners(e);else{let e=i.service.getPrice(n,s);a.html(F(e))}this.updateTotalPrice()})),this.isMultibookingEnabled()&&r.on("click",(i=>{i.stopPropagation(),e.remove();let s=this.cart.getItem(t);this.cart.removeItem(t),this.cart.isEmpty()&&this.$noItems.removeClass("mpa-hide"),this.updateTotalPrice(),this.react(),document.dispatchEvent(new CustomEvent("mpa_remove_from_cart",{detail:{cartItem:s,currencyCode:h().settings().getCurrency()}}))})),this.isMultibookingEnabled()||n.on("click",(()=>{this.cart.setActiveItem(t),this.cancel()}))}updateTotalPrice(){this.$totalPrice.html(function(e,t={}){return t.literal_free=!1,F(e,t)}(this.cart.getTotalPrice()))}isMultibookingEnabled(){return h().settings().isMultibookingEnabled()}isValidInput(){return!this.cart.isEmpty()}createNew(){this.isActive&&(this.disable(),this.triggerNew())}triggerNew(){this.$element.trigger("mpa_booking_step_new",{step:this.stepId})}maybeSubmit(){this.isBeginCheckoutEventSent||(document.dispatchEvent(new CustomEvent("mpa_begin_checkout",{detail:{cart:this.cart,currencyCode:h().settings().getCurrency()}})),this.isBeginCheckoutEventSent=!0)}}function Ae(e){return function(e,t=!1){return Te().service().findAll(e,t)}(e.getServiceIds()).then((t=>(e.updateServices(t),t)))}class xe extends Ee{setupProperties(){super.setupProperties(),this.wasMultipleReservation=!1,this.$buttonEdit=this.$buttons.find(".mpa-button-edit")}addListeners(){super.addListeners(),this.$buttonEdit.on("click",this.startEditing.bind(this))}startEditing(){this.$element.removeClass("mpa-loaded").addClass("editable"),this.$buttonNew.prop("disabled",!0),function(e,t=null){t||(t=new oe),e.find(".mpa-cart-item:not(.mpa-cart-item-template)").each(((e,i)=>{let s=i.getAttribute("data-id")||"",a=t.createItem(s),r=jQuery(i);s!==a.getItemId()&&(s=a.getItemId(),r.attr("data-id",s));let n=r.find('input[name*="service_id"], select[name*="service_id"]').val(),o=r.find('input[name*="employee_id"], select[name*="employee_id"]').val(),l=r.find('input[name*="location_id"], select[name*="location_id"]').val();n&&(a.service=new de(S(n))),o&&(a.employee=new he(S(o)),a.employee.name=r.find(".mpa-employee-name").text().trim()),l&&(a.location=new ce(S(l)),a.location.name=r.find(".mpa-location-name").text().trim());let h=r.find('input[name*="date"]').val(),c=r.find('input[name*="time"]').val();h&&(a.date=y(h)),c&&(a.time=new ge(c)),a.date&&a.time&&a.time.setDate(a.date);let d=r.find('input[name*="capacity"], select[name*="capacity"]').val();d&&(a.capacity=S(d))}))}(this.$element,this.cart),this.cart.setActiveItem(null),this.wasMultipleReservation=this.cart.getItemsCount()>1,this.react(),this.cart.items.forEach((e=>{let t=this.$items.find('.mpa-cart-item[data-id="'+e.getItemId()+'"]');t.length>0&&this.bindListeners(t)})),Ae(this.cart).then((()=>{this.$element.addClass("mpa-loaded"),this.$buttonNew.prop("disabled",!1)}))}react(){super.react();let e=this.cart.getItemsCount()<1||this.isMultibookingEnabled();this.$buttonNew.toggleClass("mpa-hide",!e)}isMultibookingEnabled(){return this.wasMultipleReservation||super.isMultibookingEnabled()}}class Me extends De{setupProperties(){super.setupProperties(),this.cartItem=null,this.lastHash="",this.monthSlots={},this.date="",this.time="",this.datepicker=null,this.$dateWrapper=this.$element.find(".mpa-date-wrapper"),this.$dateInput=this.$element.find(".mpa-date"),this.$timeWrapper=this.$element.find(".mpa-time-wrapper"),this.$times=this.$timeWrapper.find(".mpa-times"),this.lookedAheadMonths=0,this.maxLookAheadMonths=12,this.isSelectedFirstAvailableSlot=!1,this.availabilityService=null}setAvailabilityService(e){this.availabilityService=e}theId(){return"period"}getCartContext(){return"cart item"}propertiesSchema(){return{date:{type:"string",default:""},time:{type:"string",default:""}}}addListeners(){super.addListeners(),this.$dateInput.on("change",(e=>this.setProperty("date",e.target.value)))}loadEntities(){return this.cartItem=this.cart.getActiveItem(),this.lastHash=this.cartItem.getHash("availability"),Promise.resolve(this)}reload(){return this.cartItem.didChange(this.lastHash,"availability")?(this.$element.removeClass("mpa-loaded"),this.resetDate(),this.readyPromise=this.loadEntities(),this.monthSlots={},null!=this.datepicker&&(this.setEnabledDays([]),this.readyPromise.finally((()=>this.resetEnabledDays()))),this.readyPromise):Promise.resolve(this)}reset(){this.cartItem=this.cart.getActiveItem(),this.lastHash="",this.monthSlots={},this.resetDate()}isValidInput(){return""!=this.date&&""!=this.time}resetDate(){this.resetProperty("date")}resetTime(){this.$times.empty(),this.resetProperty("time")}setEnabledDays(e){_(e,!0)?this.datepicker.set("enable",["2000-01-01"]):this.datepicker.set("enable",e)}afterUpdate(e,t,i){"date"==e&&(""==t?this.resetTime():this.resetTimeSlots())}react(){super.react(),this.$timeWrapper.toggleClass("mpa-hide",""==this.date)}showReady(){super.showReady(),null==this.datepicker&&(this.showDatepicker(),this.resetEnabledDays())}showDatepicker(){this.datepicker=v(this.$dateInput,this.getDatepickerArgs())}getDatepickerArgs(){return{minDate:h().settings().getBusinessDate(),onMonthChange:()=>this.resetEnabledDays()}}maybeSubmit(){let e=this.cartItem;if(e.date=y(this.date),e.time=new ge(this.time),e.date&&e.time&&e.time.setDate(e.date),null===e.employee||null===e.location){let t=this.autoselectIds(),i=t[0],s=t[1];null===e.employee&&e.setEmployee(i,!1),null===e.location&&e.setLocation(s,!1)}let t=this.getCurrentMonthKey();this.cartItem.setBookingVariants(this.monthSlots[t][this.date][this.time]),document.dispatchEvent(new CustomEvent("mpa_add_to_cart",{detail:{cartItem:e,currencyCode:h().settings().getCurrency()}})),document.dispatchEvent(new CustomEvent("mpa_view_cart",{detail:{cart:this.cart,currencyCode:h().settings().getCurrency()}}))}selectFirstDateTimeSlot(){let e=this.datepicker.currentYear,t=this.datepicker.currentMonth,i=this.getMonthKey(e,t);const s=this.monthSlots[i];if(s&&Object.keys(s).length>0){const e=Object.keys(s)[0],t=Object.keys(s[e])[0];this.datepicker.setDate(e,!0);this.$times.children(".mpa-time-period").filter(((e,i)=>i.getAttribute("date-time")===t)).trigger("click"),this.isSelectedFirstAvailableSlot=!0}else{if(!0===this.isSelectedFirstAvailableSlot)return;if(this.lookedAheadMonths>=this.maxLookAheadMonths)return this.datepicker.changeMonth(-this.lookedAheadMonths),void(this.isSelectedFirstAvailableSlot=!0);this.lookedAheadMonths+=1,this.datepicker.changeMonth(1),this.reload()}}autoselectIds(){let e=[0,0],t=this.getCurrentMonthKey();if(this.monthSlots[t]&&this.monthSlots[t][this.date]){let i=this.monthSlots[t][this.date];for(let t in i)if(t===this.time){let s=i[t];e[0]=s[0][0],e[1]=s[0][1];break}}return e}waitForServiceToLoad(){let e=this.availabilityService.getServicePromise();return null!==e?e:Promise.resolve(this.cartItem.getService())}resetEnabledDays(){this.resetDate(),this.setEnabledDays([]),this.$dateWrapper.removeClass("mpa-loaded");let e=this.datepicker.currentYear,t=this.datepicker.currentMonth,i=this.getMonthKey(e,t),s=null;if(this.monthSlots[i])s=Promise.resolve(this.monthSlots[i]);else{s=function(e,t,i,s){return n("/calendar/time",{service_id:e,employee_in:s.employee_in?s.employee_in.join(","):"",location_in:s.location_in?s.location_in.join(","):"",date_from:m(t,"internal"),date_to:m(i,"internal"),exclude_cart:s.exclude_cart?s.exclude_cart:[]}).catch((e=>console.error("Failed to make time slots in mpa_time_slots().",e.message)||{}))}(this.cartItem.service.id,new Date(e,t,1),new Date(e,t+1,1),this.getTimeSlotsQueryArgs())}Promise.all([s,this.waitForServiceToLoad()]).then((e=>{let t=e[0];this.monthSlots[i]=t,this.setEnabledDays(Object.keys(t)),this.$dateWrapper.addClass("mpa-loaded"),this.selectFirstDateTimeSlot()}))}getTimeSlotsQueryArgs(){let e=this.cartItem.getEmployeeId(),t=this.cartItem.getLocationId();return{employee_in:e?[e]:this.cartItem.getAvailableEmployeeIds(),location_in:t?[t]:this.cartItem.getAvailableLocationIds(),exclude_cart:this.cart.toArray("items")}}resetTimeSlots(){this.resetTime();let e={},t=this.getCurrentMonthKey();null!=this.monthSlots[t][this.date]&&(e=this.monthSlots[t][this.date]);let i=0;for(let t in e){let s=new ge(t).toString("public",'<span class="mpa-period-end-time"> - ')+"</span>",a=this.cartItem.getService();if(a.isGroupService()){let i=a.getMinCapacity();for(let s of e[t])i=Math.max(i,s[3]);s+=" ",s+='<span class="mpa-slot-capacity">',s+='<span class="mpa-slot-capacity-label">'+a.getQuantityLabel()+":</span>",s+="&nbsp;",s+='<span class="mpa-slot-capacity-number">'+i+"</span>",s+="</span>"}let r=B(s,{class:"button button-secondary mpa-time-period","date-time":t});this.$times.append(r),i++}i>0?this.$times.children(".mpa-time-period").on("click",(e=>this.onTime(e,e.currentTarget))):this.$times.text(c("Sorry, but we were unable to allocate time slots for the date you selected.","motopress-appointment"))}getMonthKey(e,t){return t<=8?e+"-0"+(t+1):e+"-"+(t+1)}getCurrentMonthKey(){if(""!==this.date){let e=y(this.date);return this.getMonthKey(e.getFullYear(),e.getMonth())}return"2000-01"}onTime(e,t){this.$times.children(".mpa-time-period-selected").removeClass("mpa-time-period-selected"),t.classList.add("mpa-time-period-selected"),this.setProperty("time",t.getAttribute("date-time"))}}class Le extends Me{getDatepickerArgs(){let e=super.getDatepickerArgs(),t=this.cart.getMinDate(),i=new Date(t.getFullYear(),t.getMonth());return e.minDate=m(i,"internal"),e}getTimeSlotsQueryArgs(){let e=super.getTimeSlotsQueryArgs();return e.since_today=!1,e}}class Be extends De{setupProperties(){super.setupProperties(),this.availabilityService=null,this.category="",this.serviceId=0,this.employeeId=0,this.locationId=0,this.isHiddenStep=!0,this.$form=this.$element.find(".mpa-service-form"),this.$categories=this.$element.find(".mpa-service-category-wrapper"),this.$services=this.$element.find(".mpa-service-wrapper"),this.$employees=this.$element.find(".mpa-employee-wrapper"),this.$locations=this.$element.find(".mpa-location-wrapper"),this.$selects=this.$element.find(".mpa-input-wrapper select"),this.$categoriesSelect=this.$selects.filter(".mpa-service-category"),this.$servicesSelect=this.$selects.filter(".mpa-service"),this.$employeesSelect=this.$selects.filter(".mpa-employee"),this.$locationsSelect=this.$selects.filter(".mpa-location"),this.unselectedServiceText=this.$servicesSelect.children('[value=""]').text(),this.unselectedOptionText=this.$selects.filter(".mpa-optional-select").first().find("option:first").text()}setAvailabilityService(e){this.availabilityService=e}theId(){return"service-form"}getCartContext(){return"cart item"}propertiesSchema(){return{category:{type:"string",default:""},serviceId:{type:"integer",default:0},employeeId:{type:"integer",default:0},locationId:{type:"integer",default:0}}}addListeners(){super.addListeners(),this.$form.on("submit",this.submitForm.bind(this)),this.$categoriesSelect.on("change",(e=>this.setProperty("category",e.target.value))),this.$servicesSelect.on("change",(e=>this.setProperty("serviceId",e.target.value))),this.$employeesSelect.on("change",(e=>this.setProperty("employeeId",e.target.value))),this.$locationsSelect.on("change",(e=>this.setProperty("locationId",e.target.value)))}isHiddenElementByProp(e){const t=e.attr("data-is-hidden");return void 0!==t&&"false"!==t}initCategoriesSelect(){if(0==this.$categoriesSelect.length)return;this.updateCategorySchema();let e=this.$categoriesSelect.val(),t=this.isHiddenElementByProp(this.$categoriesSelect);if(this.$categoriesSelect.attr("data-default")){const i=this.$categoriesSelect.attr("data-default");this.isValidCategoryBySchema(i)?e=i:t=!1}this.setProperty("category",e),this.renderCategorySelect(),t||(this.isHiddenStep=!1),this.$categories.toggleClass("mpa-hide",t)}initServicesSelect(){if(0==this.$servicesSelect.length)return;this.updateServiceSchema();let e=this.$servicesSelect.val(),t=this.isHiddenElementByProp(this.$servicesSelect);if(this.$servicesSelect.attr("data-default")){const i=S(this.$servicesSelect.attr("data-default"));this.isValidServiceBySchema(i)?e=i:t=!1}this.setProperty("serviceId",e),this.renderServiceSelect(),t||(this.isHiddenStep=!1),this.$services.toggleClass("mpa-hide",t)}initEmployeesSelect(){if(0==this.$employeesSelect.length)return;this.updateEmployeeSchema();let e=this.$employeesSelect.val(),t=this.isHiddenElementByProp(this.$employeesSelect);if(this.$employeesSelect.attr("data-default")){const i=S(this.$employeesSelect.attr("data-default"));this.isValidEmployeeBySchema(i)?e=i:t=!1}this.setProperty("employeeId",e),this.renderEmployeeSelect(),t||(this.isHiddenStep=!1),this.$employees.toggleClass("mpa-hide",t)}initLocationsSelect(){if(0==this.$locationsSelect.length)return;this.updateLocationSchema();let e=this.$locationsSelect.val(),t=this.isHiddenElementByProp(this.$locationsSelect);if(this.$locationsSelect.attr("data-default")){const i=S(this.$locationsSelect.attr("data-default"));this.isValidLocationBySchema(i)?e=i:t=!1}this.setProperty("locationId",e),this.renderLocationSelect(),t||(this.isHiddenStep=!1),this.$locations.toggleClass("mpa-hide",t)}loadEntities(){return this.availabilityService.ready().finally((()=>(this.initServicesSelect(),this.initCategoriesSelect(),this.initEmployeesSelect(),this.initLocationsSelect(),this)))}reset(){let e={category:this.$categoriesSelect,serviceId:this.$servicesSelect,employeeId:this.$employeesSelect,locationId:this.$locationsSelect};this.preventReact=!0;for(let t in e){let i=e[t].attr("data-default");i?this.setProperty(t,i):this.resetProperty(t)}this.preventReact=!1,this.isActive&&this.react()}isValidInput(){return 0!=this.serviceId}updateCategorySchema(){const e=this.availabilityService.getAvailableServiceCategories();this.schema.category.options=Object.keys(e)}updateServiceSchema(){const e=this.availabilityService.getAvailableServices(this.category,this.locationId,this.employeeId);this.schema.serviceId.options=Object.keys(e).map(S)}updateEmployeeSchema(){const e=this.availabilityService.getAvailableEmployees(this.serviceId,this.locationId);this.schema.employeeId.options=Object.keys(e).map(S)}updateLocationSchema(){const e=this.availabilityService.getAvailableLocations(this.serviceId,this.employeeId);this.schema.locationId.options=Object.keys(e).map(S)}isValidCategoryBySchema(e){return this.schema.category.options.includes(e)}isValidServiceBySchema(e){return this.schema.serviceId.options.includes(e)}isValidLocationBySchema(e){return this.schema.locationId.options.includes(e)}isValidEmployeeBySchema(e){return this.schema.employeeId.options.includes(e)}afterUpdate(e,t,i){if(this.updateCategorySchema(),this.updateServiceSchema(),this.updateEmployeeSchema(),this.updateLocationSchema(),"category"===e){let e=this.availabilityService.getAvailableServices(this.category,this.locationId,this.employeeId);this.serviceId in e||(this.resetProperty("serviceId"),this.resetProperty("employeeId"),this.resetProperty("locationId"))}}react(){super.react(),this.$categoriesSelect.val(this.category||""),this.$servicesSelect.val(this.serviceId||""),this.$employeesSelect.val(this.employeeId),this.$locationsSelect.val(this.locationId),this.$categoriesSelect.toggleClass("mpa-selected",""!=this.category),this.$servicesSelect.toggleClass("mpa-selected",0!=this.serviceId),this.$employeesSelect.toggleClass("mpa-selected",0!=this.employeeId),this.$locationsSelect.toggleClass("mpa-selected",0!=this.locationId),this.renderCategorySelect(),this.renderServiceSelect(),this.renderEmployeeSelect(),this.renderLocationSelect(),this.$buttonNext.prop("disabled",!1)}renderCategorySelect(){this.preventUpdate=!0,Q(this.$categoriesSelect,{"":this.unselectedOptionText},this.availabilityService.getAvailableServiceCategories(),this.category||""),this.preventUpdate=!1}renderServiceSelect(){this.preventUpdate=!0;let e=this.availabilityService.getAvailableServices(this.category,this.locationId,this.employeeId);Q(this.$servicesSelect,{"":this.unselectedServiceText},e,this.serviceId in e?this.serviceId:""),this.preventUpdate=!1}renderEmployeeSelect(){this.preventUpdate=!0,Q(this.$employeesSelect,{0:this.unselectedOptionText},this.availabilityService.getAvailableEmployees(this.serviceId,this.locationId),this.employeeId),this.preventUpdate=!1}renderLocationSelect(){this.preventUpdate=!0,Q(this.$locationsSelect,{0:this.unselectedOptionText},this.availabilityService.getAvailableLocations(this.serviceId,this.employeeId),this.locationId),this.preventUpdate=!1}show(){this.$servicesSelect.prop("required",!0),super.show()}hide(){super.hide(),this.$servicesSelect.prop("required",!1)}enable(){super.enable(),this.$selects.prop("disabled",!1)}disable(){super.disable(),this.$selects.prop("disabled",!0)}submitForm(e){this.isActive&&!this.isValidInput()||e.preventDefault()}maybeSubmit(){let e=this.cart.getActiveItem();if(null===e)return console.error("Unable to get active cart item in StepServiceForm.maybeSubmit().");if(e.setService(this.availabilityService.getService(this.serviceId,!0,(()=>{document.dispatchEvent(new CustomEvent("mpa_view_item",{detail:{cartItem:e,currencyCode:h().settings().getCurrency()}}))}))),e.setServiceCategories(this.availabilityService.getServiceCategories(this.serviceId)),0!==this.employeeId?e.setEmployee(this.availabilityService.getEmployee(this.employeeId)):e.setAvailableEmployees(this.availabilityService.filterAvailableEmployees(this.serviceId,this.locationId,"entities")),0!==this.locationId)e.setLocation(this.availabilityService.getLocation(this.locationId));else{let t=this.employeeId||e.getAvailableEmployeeIds();e.setAvailableLocations(this.availabilityService.filterAvailableLocations(this.serviceId,t,"entities"))}}}class Ve extends s{constructor(e){super(e),this.cart=new oe,this.steps=new Pe(this.cart),this.load()}setupSteps(){this.steps.addStep(new Be(this.$element.find(".mpa-booking-step-service-form"),this.cart)).addStep(new Le(this.$element.find(".mpa-booking-step-period"),this.cart)).addStep(new xe(this.$element.find(".mpa-booking-step-cart"),this.cart)),this.steps.mount(this.$element);let e=new ke;this.steps.getStep("service-form").setAvailabilityService(e),this.steps.getStep("period").setAvailabilityService(e),this.steps.goToStep("cart")}load(){this.setupSteps()}}class Oe extends s{constructor(e){super(e),this.$table=this.$element.find("table"),this.$rows=this.$table.children("tbody"),this.$addButton=this.$element.find(".mpa-add-button"),this.inputName=this.$element.attr("data-base-name"),this.variations={},this.count=0,this.employees={},this.durations={},this.findVariations(),this.getEmployees(),this.getDurations(),this.clearElement(),this.addListeners()}findVariations(){this.$element.find(".mpa-variation").each(((e,t)=>{let i=jQuery(t),s=i.attr("data-id");this.variations[s]=i,this.count++}))}getEmployees(){this.$element.find(".mpa-employees-list option").each(((e,t)=>{let i=parseInt(t.value),s=t.text;this.employees[i]=s}))}getDurations(){this.$element.find(".mpa-durations-list option").each(((e,t)=>{let i=parseInt(t.value),s=t.text;this.durations[i]=s}))}clearElement(){this.$element.children(".mpa-data-lists").remove()}addListeners(){this.$addButton.on("click",this.addRow.bind(this)),this.$element.find(".mpa-remove-button").on("click",(e=>this.removeRowByElement(e.target)))}addRow(){let e=C(),t=this.renderRow(e);this.$rows.append(t);let i=this.$rows.find('[data-id="'+e+'"]');this.variations[e]=i,this.count++,this.$table.removeClass("mpa-hide"),i.find(".mpa-remove-button").on("click",(e=>this.removeRowByElement(e.target)))}renderRow(e){let t=this.inputName+"["+e+"]",i="";return i+='<tr class="mpa-variation" data-id="'+e+'">',i+='<td class="column-employee">',i+=j(this.employees,0,{name:`${t}[employee]`,class:"mpa-employees"}),i+="</td>",i+='<td class="column-price">',i+='<input class="mpa-price" type="number" name="'+t+'[price]" value="" min="0" step="0.01">',i+="</td>",i+='<td class="column-duration">',i+=j(this.durations,0,{name:`${t}[duration]`,class:"mpa-durations"}),i+="</td>",i+='<td class="column-min-capacity">',i+='<input class="small-text" type="number" name="'+t+'[min_capacity]" value="" min="1" step="1">',i+="</td>",i+='<td class="column-max-capacity">',i+='<input class="small-text" type="number" name="'+t+'[max_capacity]" value="" min="1" step="1">',i+="</td>",i+='<td class="column-actions">'+V("trash","mpa-remove-button")+"</td>",i+="</tr>",i}removeRowByElement(e){let t=jQuery(e).parents(".mpa-variation").attr("data-id");t&&this.removeRow(t)}removeRow(e){this.variations.hasOwnProperty(e)&&(this.variations[e].remove(),delete this.variations[e],this.count--,0===this.count&&this.$table.addClass("mpa-hide"))}}class Re extends s{constructor(e){super(e),this.$daysContainer=this.$element.find(".mpa-days-container"),this.$formTable=this.$element.find(".mpa-edit-table"),this.$dayInput=this.$formTable.find(".mpa-day-of-week"),this.timeSelects=this.$formTable.find(".mpa-period"),this.$startTimeHoursInput=this.$formTable.find(".mpa-period__start-hours"),this.$startTimeMinutesInput=this.$formTable.find(".mpa-period__start-minutes"),this.$endTimeHoursInput=this.$formTable.find(".mpa-period__end-hours"),this.$endTimeMinutesInput=this.$formTable.find(".mpa-period__end-minutes"),this.$timeAllDayInput=this.$formTable.find(".mpa-period__all-day"),this.$activityInput=this.$formTable.find(".mpa-activity"),this.$locationInput=this.$formTable.find(".mpa-location"),this.$errorWrapper=this.$formTable.find(".mpa-end-time + .mpa-error"),this.$addButton=this.$element.find(".mpa-add-button"),this.$cancelButton=this.$element.find(".mpa-cancel-button"),this.addingPeriod=!1,this.baseName=this.$element.attr("data-base-name"),this.findPeriods(),this.fillActivities(),this.fillLocations(),this.addListeners()}findPeriods(){this.periods={monday:{},tuesday:{},wednesday:{},thursday:{},friday:{},saturday:{},sunday:{}},this.periodsMap={};let e=this;this.$element.find(".mpa-day-period").each((function(t,i){let s=jQuery(i),a=s.attr("data-id"),r=s.children(".mpa-period-day").val(),n=parseInt(s.children(".mpa-period-start").val());e.periods[r][a]={startTime:n,$element:s},e.periodsMap[a]=r}))}fillActivities(){this.activities={},this.$activityInput.children().each(((e,t)=>{let i=t.value,s=t.text;this.activities[i]=s}))}fillLocations(){this.locations={},this.$locationInput.children().each(((e,t)=>{let i=t.value,s=t.text;""!==i&&(this.locations[i]=s)}))}addListeners(){this.$timeAllDayInput.on("change",(e=>{e.target.checked?this.timeSelects.hide():this.timeSelects.show()})),this.$addButton.on("click",(()=>{this.addingPeriod?this.isValidEditingPeriod()?(this.$errorWrapper.addClass("mpa-hide"),this.addPeriod({day:this.getDay(),startTime:this.getStartTime(),endTime:this.getEndTime(),activity:this.getActivity(),location:this.getLocation()}),this.$formTable.addClass("mpa-hide"),this.addingPeriod=!1):this.$errorWrapper.removeClass("mpa-hide"):(this.addingPeriod=!0,this.resetInputs(),this.$formTable.removeClass("mpa-hide"))})),this.$cancelButton.on("click",(()=>{this.$formTable.addClass("mpa-hide"),this.addingPeriod=!1}));let e=this;this.$element.find(".mpa-remove-button").on("click",(function(){e.removePeriodByElement(this)}))}getDay(){return this.$dayInput.val()}getStartTime(){let e=0;return this.$timeAllDayInput.prop("checked")||(e=60*parseInt(this.$startTimeHoursInput.val())+parseInt(this.$startTimeMinutesInput.val())),e}getEndTime(){let e=0;return this.$timeAllDayInput.prop("checked")||(e=60*parseInt(this.$endTimeHoursInput.val())+parseInt(this.$endTimeMinutesInput.val())),e}getActivity(){return this.$activityInput.val()}getLocation(){let e=this.$locationInput.val();return""!==e&&(e=parseInt(e)),e}isValidEditingPeriod(){let e=this.getStartTime(),t=this.getEndTime();return t>e||0===t}addPeriod(e){let t=C(),i=this.renderPeriod(e,t),s=!1;for(let t in this.periods[e.day])if(e.startTime<this.periods[e.day][t].startTime){jQuery(i).insertBefore(this.periods[e.day][t].$element),s=!0;break}s||this.$daysContainer.children('[data-for="'+e.day+'"]').children(".mpa-day-periods").append(i);let a=this.$daysContainer.find('[data-id="'+t+'"]');this.periods[e.day][t]={startTime:e.startTime,$element:a},this.periodsMap[t]=e.day;let r=this;a.find(".mpa-remove-button").on("click",(function(){r.removePeriodByElement(this)}))}renderPeriod(e,t){let i=this.baseName+"["+t+"]",s="";return s+='<div class="mpa-day-period" data-id="'+t+'">',s+='<input type="hidden" name="'+i+'[day]" value="'+e.day+'">',s+='<input type="hidden" name="'+i+'[start]" value="'+e.startTime+'">',s+='<input type="hidden" name="'+i+'[end]" value="'+e.endTime+'">',s+='<input type="hidden" name="'+i+'[activity]" value="'+e.activity+'">',s+='<input type="hidden" name="'+i+'[location]" value="'+e.location+'">',s+='<span class="mpa-period-time">',0===e.startTime&&0===e.startTime&&e.startTime===e.endTime?s+=c("All day","motopress-appointment"):(s+=A(e.startTime),s+="&nbsp;&nbsp;",s+=A(e.endTime)),s+="</span>",s+=V("trash","mpa-remove-button"),s+="<br>",s+='<span class="mpa-period-activity">',s+=this.activities[e.activity],s+="</span>",""!==e.location&&"work"==e.activity&&(s+="<br>",s+='<span class="mpa-period-location">',s+=d("at %s","Working at %s","motopress-appointment").replace("%s",function(e,t=""){return`<a href="wp-admin/post.php?post=${e}&action=edit" title="`+t+'">'+t+"</a>"}(e.location,this.locations[e.location])),s+="</span>"),s+="</div>",s}removePeriodByElement(e){let t=jQuery(e).parents(".mpa-day-period").attr("data-id");t&&this.removePeriod(t)}removePeriod(e){if(!this.periodsMap.hasOwnProperty(e))return;let t=this.periodsMap[e];this.periods[t][e].$element.remove(),delete this.periods[t][e],delete this.periodsMap[e]}resetInputs(){this.$errorWrapper.addClass("mpa-hide")}onCancel(){this.$formTable.addClass("mpa-hide"),this.addingPeriod=!1}}class Fe extends s{constructor(e){super(e),this.$input=this.$element.find("input"),this.$datalist=this.$element.find("datalist"),this.$input.on("input",this.reloadUserEmails.bind(this)),this.reloadUserEmails()}reloadUserEmails(){let e=this;jQuery.ajax({url:mpaUserMetaboxSettings.root+"wp/v2/users/",method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",mpaUserMetaboxSettings.nonce)},data:{context:"edit",search:e.$input.val(),per_page:100,orderby:"email"}}).done((function(t){e.$datalist.empty(),t.forEach((t=>{e.$datalist.append('<option value="'+t.email+'"></option>')}))}))}}class je{constructor(e){this.$element=e,this.$toggle=e.children(".dropdown-toggle"),this.$menu=e.children(".dropdown-menu"),this.$menuItems=this.$menu.children(".dropdown-item"),this.isDoingClick=!1,this.addListeners(),this.setInited()}addListeners(){this.$toggle.on("click",this.showMenu.bind(this)),this.$toggle.on("blur",this.onBlur.bind(this)),this.$menuItems.on("mousedown",this.beforeClick.bind(this)),this.$menuItems.on("mouseup",this.afterClick.bind(this))}setInited(){this.$element.addClass("inited")}toggleMenu(){this.$menu.toggleClass("show")}showMenu(){this.$menu.addClass("show")}hideMenu(){this.$menu.removeClass("show")}beforeClick(){this.isDoingClick=!0}afterClick(){this.isDoingClick=!1,this.hideMenu()}onBlur(e){this.isDoingClick?e.preventDefault():this.hideMenu()}}new class{constructor(){this.setupComponents(),this.exportInstance()}setupComponents(){this.setupDropdowns()}setupDropdowns(){jQuery(".mpa-dropdown:not(.inited)").each((function(e,t){new je(jQuery(t))}))}exportInstance(){var e,t;e="Bootstrap",t=this,null==window.MotoPress&&(window.MotoPress={}),null==window.MotoPress.Appointment&&(window.MotoPress.Appointment={}),window.MotoPress.Appointment[e]=t}},new class{constructor(){this.setupFields(jQuery(".mpa-ctrl:not([data-inited])"))}setupFields(e){e.each((function(e,t){let i=jQuery(t);switch(i.attr("data-type")){case"color-picker":new a(i);break;case"date":new f(i);break;case"image":new $(i);break;case"phone":new I(i);break;case"attributes":new W(i);break;case"custom-workdays":new z(i);break;case"days-off":new K(i);break;case"edit-reservations":new Ve(i);break;case"service-variations":new Oe(i);break;case"timetable":new Re(i);break;case"employee-user":new Fe(i)}}))}},new class{constructor(){0!==jQuery("#mpa_appointment_form_metabox").length&&(this.availability=new ke,this.availability.load().finally((()=>{this.defaultValuesDependency()})),this.$showItemsCategory=jQuery("#_mpa_show_items-category"),this.$showItemsCategoryLabel=this.$showItemsCategory.parent(),this.$showItemsService=jQuery("#_mpa_show_items-service"),this.$showItemsServiceLabel=this.$showItemsService.parent(),this.$defaultValuesCategory=jQuery("#_mpa_default_category"),this.$defaultValuesService=jQuery("#_mpa_default_service"),this.$defaultValuesLocation=jQuery("#_mpa_default_location"),this.$defaultValuesEmployee=jQuery("#_mpa_default_employee"),this.showItemsCategoryProp=this.$showItemsCategory.prop("checked"),this.showItemsCategoryLabelTooltipText=p(c("To enable this option, you need to check the '%s' box.","motopress-appointment"),c("Service","motopress-appointment")),this.showItemsServiceLabelTooltipText=c("To enable booking for the specific service only, select the service below first, then uncheck the 'Service' box here.","motopress-appointment"),this.dependencyOfShowServiceToDefaultValueOfService(),this.toggleCategoryBasedOnService(),this.addListeners())}addListeners(){this.$showItemsCategory.on("change",(()=>this.updateShowItemsCategoryProp())),this.$showItemsService.on("change",(()=>this.toggleCategoryBasedOnService())),this.$defaultValuesService.on("change",(()=>this.dependencyOfShowServiceToDefaultValueOfService())),this.$showItemsServiceLabel.on("click",(()=>this.makeFocusToServiceSelect())),this.$defaultValuesCategory.on("change",(()=>this.defaultValuesDependency())),this.$defaultValuesService.on("change",(()=>this.defaultValuesDependency())),this.$defaultValuesLocation.on("change",(()=>this.defaultValuesDependency())),this.$defaultValuesEmployee.on("change",(()=>this.defaultValuesDependency()))}updateShowItemsCategoryProp(){this.showItemsCategoryProp=this.$showItemsCategory.prop("checked")}toggleCategoryBasedOnService(){!1===this.$showItemsService.prop("checked")?(this.$showItemsCategory.prop("disabled",!0),this.$showItemsCategory.prop("checked",!1),this.$showItemsCategoryLabel.toggleClass("mpa_tooltip",!0),this.$showItemsCategoryLabel.attr("data-tooltip",this.showItemsCategoryLabelTooltipText)):(this.$showItemsCategory.prop("disabled",!1),this.$showItemsCategory.prop("checked",this.showItemsCategoryProp),this.$showItemsCategoryLabel.toggleClass("mpa_tooltip",!1))}dependencyOfShowServiceToDefaultValueOfService(){this.$defaultValuesService.val()&&"0"!==this.$defaultValuesService.val()?(this.$showItemsService.prop("disabled",!1),this.$showItemsServiceLabel.toggleClass("mpa_tooltip",!1),this.$showItemsServiceLabel.removeAttr("data-tooltip")):(this.$showItemsService.prop("disabled",!0),this.$showItemsService.prop("checked",!0),this.$showItemsServiceLabel.toggleClass("mpa_tooltip",!0),this.$showItemsServiceLabel.attr("data-tooltip",this.showItemsServiceLabelTooltipText))}makeFocusToServiceSelect(){!0===this.$showItemsService.prop("disabled")&&this.$defaultValuesService.focus()}defaultValuesDependency(){const e=jQuery("#_mpa_label_unselected").val(),t=e||c(" Select ","motopress-appointment"),i=jQuery("#_mpa_label_option").val(),s=i||c(" Any ","motopress-appointment"),a=this.$defaultValuesCategory.val(),r=S(this.$defaultValuesService.val()),n=S(this.$defaultValuesEmployee.val()),o=S(this.$defaultValuesLocation.val()),l=this.availability.isAvailableService(r)?r:0,h=this.availability.isAvailableServiceCategory(a)?a:"",d=this.availability.isAvailableLocation(o)?o:0,p=this.availability.isAvailableEmployee(n)?n:0,u=this.availability.getAvailableServiceCategories(),m=this.availability.getAvailableServices(h,d,p),y=this.availability.getAvailableLocations(l,p),g=this.availability.getAvailableEmployees(l,d);Q(this.$defaultValuesCategory,{"":s},u,u.hasOwnProperty(h)?h:""),Q(this.$defaultValuesService,{0:t},m,m.hasOwnProperty(l)?l:0),Q(this.$defaultValuesLocation,{0:s},y,y.hasOwnProperty(d)?d:0),Q(this.$defaultValuesEmployee,{0:s},g,g.hasOwnProperty(p)?p:0)}}}(wp.date,intlTelInput,mpaData)}();
