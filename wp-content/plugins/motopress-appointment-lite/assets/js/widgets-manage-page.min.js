!function(){"use strict";!function(e,t,i){class s{constructor(e,t={}){this.id=e,this.setupProperties(),this.setupValues(t)}setupProperties(){}setupValues(e){for(let t in e)this[t]=e[t]}getId(){return this.id}}class r extends s{setupProperties(){super.setupProperties(),this.name=""}}class a extends s{setupProperties(){super.setupProperties(),this.name=""}}function n(e,t){return e.filter((e=>-1!=t.indexOf(e)))}const o="undefined"!=typeof wp&&wp.i18n&&wp.i18n.__?wp.i18n.__:(e,t="")=>e,l="undefined"!=typeof wp&&wp.i18n&&wp.i18n._x?wp.i18n._x:(e,t,i="")=>e,h="undefined"!=typeof wp&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(e,...t)=>{let i=0;return e.replace(/%([sdf])/g,((e,s)=>{if(i>=t.length)return e;let r=t[i++];switch(s){case"s":return String(r);case"d":return parseInt(r,10);case"f":return parseFloat(r);default:return e}}))};class u extends s{setupProperties(){super.setupProperties(),this.name="",this.price=0,this.depositType="disabled",this.depositAmount=0,this.duration=0,this.bufferTimeBefore=0,this.bufferTimeAfter=0,this.timeBeforeBooking="",this.maxAdvanceTimeBeforeReservation="",this.minCapacity=1,this.maxCapacity=1,this.multiplyPrice=!1,this.isGroupServiceEnabled=!1,this.customQuantityLabel="",this.variations={},this.image="",this.thumbnail=""}getName(){return this.name}getPrice(e=0,t=0){t||(t=this.minCapacity);let i=this.getVariation("price",e,this.price);return this.multiplyPrice&&(i*=t),i}getDuration(e=0){return this.getVariation("duration",e,this.duration)}getMinCapacity(e=0){return this.getVariation("min_capacity",e,this.minCapacity)}getMaxCapacity(e=0){return this.getVariation("max_capacity",e,this.maxCapacity)}getVariation(e,t,i){return t in this.variations?this.variations[t][e]:i}setName(e){this.name=e}isGroupService(){return this.isGroupServiceEnabled}getCustomQuantityLabel(){return this.customQuantityLabel}getQuantityLabel(){return""!==this.customQuantityLabel?this.getCustomQuantityLabel():o("Clients","motopress-appointment")}}class p{static loadInBackground(e,t,i=!1){return t.findById(e.id,i).then((t=>{if(null!==t)for(let i in t)e[i]=t[i];return t}))}}let c="/motopress/appointment/v1";function m(e,t={}){return function(e,t={},i="GET"){return new Promise(((s,r)=>{wp.apiRequest({path:c+e,type:i,data:t}).done((e=>s(e))).fail(((e,t)=>{let i="parsererror";i=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:`Status: ${t}`,"parsererror"==i&&(i="REST request failed. Maybe PHP error on the server side. Check PHP logs."),r(new Error(i))}))}))}(e,t,"GET")}class d{constructor(){this.settings=this.getDefaults(),this.loadingPromise=this.load()}getDefaults(){return{plugin_name:"Appointment Booking",today:"2030-01-01",business_name:"",default_time_step:30,default_booking_status:"confirmed",confirmation_mode:"auto",terms_page_id_for_acceptance:0,allow_multibooking:!1,allow_coupons:!1,allow_customer_account_creation:!1,country:"",currency:"EUR",currency_symbol:"&euro;",currency_position:"before",decimal_separator:".",thousand_separator:",",number_of_decimals:2,timezone:"UTC",date_format:"F j, Y",time_format:"H:i",week_starts_on:0,thumbnail_size:{width:150,height:150},flatpickr_locale:"en",enable_payments:!1,active_gateways:[],reservation_received_page_url:"",failed_transaction_page_url:"",default_payment_gateway:""}}load(){return new Promise(((e,t)=>{m("/settings").then((e=>this.settings=e),(e=>console.error("Unable to load public settings.",e))).finally((()=>e(this.settings)))}))}ready(){return this.loadingPromise}getPluginName(){return this.settings.plugin_name}getBusinessDate(){return this.settings.today}getBusinessName(){return this.settings.business_name}getTimeStep(){return this.settings.default_time_step}getDefaultBookingStatus(){return this.settings.default_booking_status}getConfirmationMode(){return this.settings.confirmation_mode}getTermsPageIdForAcceptance(){return this.settings.terms_page_id_for_acceptance}isMultibookingEnabled(){return this.settings.allow_multibooking}isCouponsEnabled(){return this.settings.allow_coupons}isAllowCustomerAccountCreation(){return this.settings.allow_customer_account_creation}getCountry(){return this.settings.country}getCurrency(){return this.settings.currency}getCurrencySymbol(){return this.settings.currency_symbol}getCurrencyPosition(){return this.settings.currency_position}getDecimalSeparator(){return this.settings.decimal_separator}getThousandSeparator(){return this.settings.thousand_separator}getDecimalsCount(){return this.settings.number_of_decimals}getTimezone(){return this.settings.timezone}getDateFormat(){return this.settings.date_format}getTimeFormat(){return this.settings.time_format}getFirstDayOfWeek(){return this.settings.week_starts_on}getThumbnailSize(){return this.settings.thumbnail_size}getFlatpickrLocale(){return this.settings.flatpickr_locale}isPaymentsEnabled(){return this.settings.enable_payments}getActiveGateways(){return this.settings.active_gateways}getReservationReceivedPageUrl(){return this.settings.reservation_received_page_url}getFailedTransactionPageUrl(){return this.settings.failed_transaction_page_url}getDefaultPaymentGateway(){return this.settings.default_payment_gateway}}class g{constructor(){this.settingsCtrl=new d,this.loadingPromise=this.load()}load(){return Promise.all([this.settingsCtrl.ready()]).then((()=>this))}ready(){return this.loadingPromise}settings(){return this.settingsCtrl}static getInstance(){return null==g.instance&&(g.instance=new g),g.instance}}function y(){return g.getInstance()}const f={weekdays:{shorthand:[o("Sun","motopress-appointment"),o("Mon","motopress-appointment"),o("Tue","motopress-appointment"),o("Wed","motopress-appointment"),o("Thu","motopress-appointment"),o("Fri","motopress-appointment"),o("Sat","motopress-appointment")],longhand:[o("Sunday","motopress-appointment"),o("Monday","motopress-appointment"),o("Tuesday","motopress-appointment"),o("Wednesday","motopress-appointment"),o("Thursday","motopress-appointment"),o("Friday","motopress-appointment"),o("Saturday","motopress-appointment")]},months:{shorthand:[o("Jan","motopress-appointment"),o("Feb","motopress-appointment"),o("Mar","motopress-appointment"),o("Apr","motopress-appointment"),l("May","Month (short)","motopress-appointment"),o("Jun","motopress-appointment"),o("Jul","motopress-appointment"),o("Aug","motopress-appointment"),o("Sep","motopress-appointment"),o("Oct","motopress-appointment"),o("Nov","motopress-appointment"),o("Dec","motopress-appointment")],longhand:[o("January","motopress-appointment"),o("February","motopress-appointment"),o("March","motopress-appointment"),o("April","motopress-appointment"),l("May","Month","motopress-appointment"),o("June","motopress-appointment"),o("July","motopress-appointment"),o("August","motopress-appointment"),o("September","motopress-appointment"),o("October","motopress-appointment"),o("November","motopress-appointment"),o("December","motopress-appointment")]},amPM:["AM","PM"],firstDayOfWeek:y().settings().getFirstDayOfWeek()};function v(t,i="public"){if("string"==typeof t)return t;if("internal"==i)return v(t,"Y-m-d");if("public"==i)return e.format(y().settings().getDateFormat(),t);let s=(e,t=2)=>("00"+e).slice(-t),r=!1;return i.split("").map((e=>{if(r)return r=!1,e;switch(e){case"\\":return r=!0,"";case"j":return t.getDate();case"d":return s(t.getDate());case"D":return f.weekdays.shorthand[t.getDay()];case"l":return f.weekdays.longhand[t.getDay()];case"N":return t.getDay()||7;case"w":return t.getDay();case"z":let i=new Date(t.getFullYear(),0,1),a=i.getTimezoneOffset()-t.getTimezoneOffset(),n=t-i+60*a*1e3,o=864e5;return Math.floor(n/o);case"W":let l=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),h=l.getUTCDay()||7;l.setUTCDate(l.getUTCDate()+4-h);let u=new Date(Date.UTC(l.getUTCFullYear(),0,1)),p=864e5;return Math.ceil(((l-u)/p+1)/7);case"F":return f.months.longhand[t.getMonth()];case"M":return f.months.shorthand[t.getMonth()];case"m":return s(t.getMonth()+1);case"n":return t.getMonth()+1;case"t":return new Date(t.getFullYear(),t.getMonth()+1,0).getDate();case"Y":return t.getFullYear();case"y":return String(t.getFullYear()).substring(2);case"L":return t.getFullYear()%4==0?1:0;case"A":return f.amPM[t.getHours()>11?1:0];case"a":return f.amPM[t.getHours()>11?1:0].toLowerCase();case"H":return s(t.getHours());case"h":return s(t.getHours()%12||12);case"G":return t.getHours();case"g":return t.getHours()%12||12;case"i":return s(t.getMinutes());case"s":return s(t.getSeconds());case"v":return s(t.getMilliseconds(),3);case"u":return s(t.getMilliseconds(),3)+"000";case"O":case"P":let c=-t.getTimezoneOffset(),m=c>=0?"+":"-",d=Math.floor(Math.abs(c)/60),g=Math.abs(c)%60,y="O"==e?"":":";return m+s(d)+y+s(g);case"Z":return 60*t.getTimezoneOffset();case"U":return Math.floor(t.getTime()/1e3);case"c":return v(t,"Y-m-d\\TH:i:sP");case"r":return v(t,"D, d M Y H:i:s O");case"S":case"o":case"B":case"e":case"T":case"I":return"";default:return e}})).join("")}function T(e){let t=e.match(/(\d{4})-(\d{2})-(\d{2})/);if(null!=t){let e=parseInt(t[1]),i=parseInt(t[2]),s=parseInt(t[3]);return new Date(e,i-1,s)}return null}function b(){let e=new Date;return e.setHours(0,0,0,0),e}class w extends s{setupProperties(){super.setupProperties(),this.status="new",this.code="",this.description="",this.type="fixed",this.amount=0,this.expirationDate=null,this.serviceIds=[],this.minDate=null,this.maxDate=null,this.usageLimit=0,this.usageCount=0}setupValues(e){for(let t of["expirationDate","minDate","maxDate"]){let i=e[t];null!=i&&""!==i&&(this[t]=T(i)),delete e[t]}super.setupValues(e)}getCode(){return this.code}isApplicableForCart(e){let t=!1;return e.items.forEach((e=>{if(this.isApplicableForCartItem(e))return t=!0,!1})),t}isApplicableForCartItem(e){return!!e.isSet()&&(!(this.serviceIds.length>0&&-1==this.serviceIds.indexOf(e.service.id))&&(!(null!=this.minDate&&e.date<this.minDate)&&!(null!=this.maxDate&&e.date>this.maxDate)))}calcDiscountAmount(e){let t=this.calcDiscountForCart(e);return Math.min(t,e.getSubtotalPrice())}calcDiscountForCart(e){let t=0;return e.items.forEach((e=>{t+=this.calcDiscountForCartItem(e)})),t}calcDiscountForCartItem(e){let t=0;if(this.isApplicableForCartItem(e)){let i=e.getPrice();switch(this.type){case"fixed":t=this.amount;break;case"percentage":t=i*this.amount/100}t=Math.min(t,i)}return t}}function _(e){let t=parseInt(e);return isNaN(t)?e<<0:t}class D{constructor(e){var t;this.postType=e,this.entityType=0===(t=e).indexOf("mpa_")?t.substring(4):0===t.indexOf("_mpa_")?t.substring(5):t,this.savedEntities={}}findById(e,t=!1){return e?!t&&this.haveEntity(e)&&null!=this.getEntity(e)?Promise.resolve(this.getEntity(e)):this.requestEntity(e).then((t=>{let i=this.mapRestDataToEntity(t);return this.saveEntity(e,i),i}),(t=>(this.saveEntity(e,null),null))):Promise.resolve(null)}findAll(e,t=!1){let i=[],s=[];for(let r of e)this.haveEntity(r)&&!t?s.push(this.getEntity(r)):i.push(r);return 0===i.length?Promise.resolve(s):this.requestEntities(i).then((e=>{for(let t of e){let e=this.mapRestDataToEntity(t);this.saveEntity(e.id,e),s.push(e)}return s}),(e=>[]))}requestEntity(e){return m(this.getRoute(),{id:e})}requestEntities(e){return m(this.getRoute(),{id:e})}haveEntity(e){return e in this.savedEntities}getEntity(e){return this.savedEntities[e]||null}saveEntity(e,t){this.savedEntities[e]=t}mapRestDataToEntity(e){return null}getRoute(){return`/${this.entityType}s`}}class C extends D{findByCode(e,t=!1){return m(this.getRoute(),{code:e}).then((e=>{let t=this.mapRestDataToEntity(e);return this.saveEntity(t.getId(),t),t}),(e=>{if(t)return null;throw e}))}mapRestDataToEntity(e){return new w(e.id,e)}}function S(e,t="public"){return v(e,"internal"==t?"H:i":"public"==t?y().settings().getTimeFormat():t)}function P(e){let t=e.split(":"),i=parseInt(t[0]),s=parseInt(t[1]),r=b();return r.setHours(i,s),r}class k{constructor(e,t=null){this.setupProperties(),null==t?this.parsePeriod(e):(this.setStartTime(e),this.setEndTime(t))}setupProperties(){this.startTime=null,this.endTime=null}parsePeriod(e){let t=e.split(" - ");this.setStartTime(t[0]),this.setEndTime(t[1])}setStartTime(e){this.startTime="string"==typeof e?P(e):new Date(e)}setEndTime(e){this.endTime="string"==typeof e?P(e):new Date(e),0===this.endTime.getHours()&&0===this.endTime.getMinutes()&&this.startTime.getFullYear()===this.endTime.getFullYear()&&this.startTime.getMonth()===this.endTime.getMonth()&&this.startTime.getDate()===this.endTime.getDate()&&this.endTime.setDate(this.endTime.getDate()+1)}setDate(e){this.startTime.setFullYear(e.getFullYear()),this.startTime.setMonth(e.getMonth(),e.getDate()),this.endTime.setFullYear(e.getFullYear()),this.endTime.setMonth(e.getMonth(),e.getDate()),0===this.endTime.getHours()&&0===this.endTime.getMinutes()&&this.startTime.getFullYear()===this.endTime.getFullYear()&&this.startTime.getMonth()===this.endTime.getMonth()&&this.startTime.getDate()===this.endTime.getDate()&&this.endTime.setDate(this.endTime.getDate()+1)}intersectsWith(e){return this.startTime<e.endTime&&this.endTime>e.startTime}isSubperiodOf(e){return this.startTime>=e.startTime&&this.endTime<=e.endTime}mergePeriod(e){this.startTime.setTime(Math.min(this.startTime.getTime(),e.startTime.getTime())),this.endTime.setTime(Math.max(this.endTime.getTime(),e.endTime.getTime()))}diffPeriod(e){this.startTime<e.startTime?this.endTime.setTime(Math.min(e.startTime.getTime(),this.endTime.getTime())):this.startTime.setTime(Math.max(e.endTime.getTime(),this.startTime.getTime()))}splitByPeriod(e){let t=[];return e.startTime.getTime()-this.startTime.getTime()>0&&t.push(new k(this.startTime,e.startTime)),this.endTime.getTime()-e.endTime.getTime()>0&&t.push(new k(e.endTime,this.endTime)),t}isEmpty(){return this.endTime.getTime()-this.startTime.getTime()<=0}toString(e="public",t=" - "){"internal"==e&&(t=" - ");let i="short"==e?"public":e,s=S(this.startTime,i),r=S(this.endTime,i);return"internal"!==e&&0===this.startTime.getHours()&&0===this.startTime.getMinutes()&&s===r?o("All day","motopress-appointment"):"short"==e&&s==r?s:s+t+r}}class E extends s{setupProperties(){super.setupProperties(),this.serviceId=0,this.date=null,this.serviceTime=null,this.bufferTime=null}setupValues(e){for(let t in e)"date"==t?this.setDate(e[t]):"serviceTime"==t?this.setServiceTime(e[t]):"bufferTime"==t?this.setBufferTime(e[t]):this[t]=e[t]}setDate(e){this.date="string"==typeof e?T(e):e,null!=this.serviceTime&&this.serviceTime.setDate(this.date),null!=this.bufferTime&&this.bufferTime.setDate(this.date)}setServiceTime(e){this.serviceTime="string"==typeof e?new k(e):e,null!=this.date&&this.serviceTime.setDate(this.date)}setBufferTime(e){this.bufferTime="string"==typeof e?new k(e):e,null!=this.date&&this.bufferTime.setDate(this.date)}}class I extends D{findAllByService(e,t={}){let i={service_id:e};return null!=t.from_date&&(i.from_date=v(t.from_date,"internal")),null!=t.to_date&&(i.to_date=v(t.to_date,"internal")),m("/bookings/reservations",i).then((e=>{let t=[];for(let i of e){let e=this.mapRestDataToEntity(i);this.saveEntity(e.id,e),t.push(e)}return t})).catch((e=>(console.error("No reservations found.",e.message),[])))}mapRestDataToEntity(e){return new E(e.id,e)}}class ${constructor(e,t=null){this.setupProperties(),null==t?this.parsePeriod(e):(this.setStartDate(e),this.setEndDate(t))}setupProperties(){this.startDate=null,this.endDate=null}parsePeriod(e){let t=e.split(" - ");this.setStartDate(t[0]),this.setEndDate(t[1])}setStartDate(e){this.startDate=this.convertToDate(e)}setEndDate(e){this.endDate=this.convertToDate(e)}convertToDate(e){return"string"==typeof e?T(e)||b():new Date(e)}calcDays(){let e=this.endDate.getTime()-this.startDate.getTime();return Math.round(e/1e3/3600/24)}inPeriod(e){return"string"==typeof e&&(e=T(e)),null!=e&&e>=this.startDate&&e<=this.endDate}splitToDates(){let e={};for(let t=new Date(this.startDate);t<=this.endDate;t.setDate(t.getDate()+1)){let i=v(t,"internal"),s=new Date(t);e[i]=s}return e}toString(){return v(this.startDate,"internal")+" - "+v(this.endDate,"internal")}}class O extends s{setupProperties(){super.setupProperties(),this.timetable=[],this.workTimetable=[],this.customWorkdays=[],this.daysOff={}}setupValues(e){for(let t in e)"timetable"==t?this.setTimetable(e[t]):"customWorkdays"==t?this.setCustomWorkdays(e[t]):"daysOff"==t?this.setDaysOff(e[t]):this[t]=e[t]}setTimetable(e){this.timetable=[],this.workTimetable=[],e.forEach((e=>{let t=[],i=[];e.forEach((e=>{let s=new k(e.time_period);t.push({time_period:s,location:e.location,activity:e.activity}),"work"==e.activity&&i.push({time_period:s,location:e.location})})),this.timetable.push(t),this.workTimetable.push(i)}))}setCustomWorkdays(e){this.customWorkdays=[];for(let t of e)this.customWorkdays.push({date_period:new $(t.date_period),time_period:new k(t.time_period)})}setDaysOff(e){this.daysOff={};for(let t of e){let e=new $(t).splitToDates();jQuery.extend(this.daysOff,e)}}isDayOff(e){return"string"!=typeof e&&(e=v(e,"internal")),e in this.daysOff}getWorkingHours(e,t=0){if(this.isDayOff(e))return[];if("string"==typeof e&&(e=T(e)),null==e)return[];let i=[],s=e.getDay();for(let e of this.workTimetable[s])0!=t&&e.location!=t||i.push(e.time_period);for(let t of this.customWorkdays)t.date_period.inPeriod(e)&&i.push(t.time_period);return i}}class A extends D{mapRestDataToEntity(e){return new O(e.id,e)}}class M extends D{mapRestDataToEntity(e){return new u(e.id,e)}}class x{constructor(){this.repositories={}}schedule(){return null==this.repositories.schedule&&(this.repositories.schedule=new A("mpa_schedule")),this.repositories.schedule}service(){return null==this.repositories.service&&(this.repositories.service=new M("mpa_service")),this.repositories.service}reservation(){return null==this.repositories.reservation&&(this.repositories.reservation=new I("mpa_reservation")),this.repositories.reservation}coupon(){return null==this.repositories.coupon&&(this.repositories.coupon=new C("mpa_coupon")),this.repositories.coupon}customer(){return void 0===this.repositories.customer&&(this.repositories.customer=new CustomerRepository),this.repositories.customer}static getInstance(){return null==x.instance&&(x.instance=new x),x.instance}}let F=null;function L(e){return function(e){return!!e}(e)}function j(e,t=!1){return"object"==typeof e?0==function(e,t=!1){return"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:t?0:1}(e):!!t||!e}class W{setupProperties(){this.availability={},this.services={},this.serviceCategories={},this.employees={},this.locations={},this.servicePromise=null,this.readyPromise=null}constructor(){this.setupProperties()}load(e=!1){return this.readyPromise=function(e=!1){return(e||null==F)&&(F=m("/services/available").catch((e=>(console.error("Unable to extract available services."),{})))),F}(e).then((e=>(this.setAvailability(e),this))),this.readyPromise}setAvailability(e){this.availability=e;for(let t in e){let i=e[t];this.services[t]=i.name;for(let e in i.categories){let t=i.categories[e];this.serviceCategories[e]=t}for(let e in i.employees){let t=i.employees[e];this.employees[e]=t.name;for(let e in t.locations){let i=t.locations[e];this.locations[e]=i}}}}isEmpty(){return j(this.availability)}ready(){return null===this.readyPromise&&this.load(),this.readyPromise}getServicePromise(){return this.servicePromise}getService(e,t=!0,i=null){let s=new u(e);return this.services.hasOwnProperty(e)&&s.setName(this.services[e]),!0===t?(this.servicePromise=p.loadInBackground(s,x.getInstance().service()),null!==i&&this.servicePromise.then(i),this.servicePromise.then((()=>s))):this.servicePromise=null,s}getServiceCategories(e){return this.availability[e].categories}getEmployee(e){let t=new r(e);return this.employees.hasOwnProperty(e)&&(t.name=this.employees[e]),t}getLocation(e){let t=new a(e);return this.locations.hasOwnProperty(e)&&(t.name=this.locations[e]),t}getAvailableServices(e="",t=0,i=0){let s={};for(let r in this.availability){let a=this.availability[r];if(""===e||e in a.categories){if(0!==t){let e=!1;if(Object.keys(a.employees).forEach((i=>{a.employees[i].locations.hasOwnProperty(t)&&(e=!0)})),!e)continue}(0===i||i in a.employees)&&(s[r]=a.name)}}return s}getAvailableServiceCategories(){let e={};for(let t in this.availability){let i=this.availability[t];jQuery.extend(e,i.categories)}return e}getAvailableEmployees(e=0,t=0){let i={};for(let s in this.availability){if(0!=e&&s!=e)continue;let r=this.availability[s];for(let e in r.employees){let s=r.employees[e];(0===t||t in s.locations)&&(i[e]=s.name)}}return i}getAvailableLocations(e=0,t=0){let i={};for(let s in this.availability){if(0!=e&&s!=e)continue;let r=this.availability[s];for(let e in r.employees){if(0!=t&&e!=t)continue;let s=r.employees[e];jQuery.extend(i,s.locations)}}return i}isAvailableServiceCategory(e){return this.getAvailableServiceCategories().hasOwnProperty(e)}isAvailableService(e){return this.getAvailableServices().hasOwnProperty(e)}isAvailableLocation(e){return this.getAvailableLocations().hasOwnProperty(e)}isAvailableEmployee(e){return this.getAvailableEmployees().hasOwnProperty(e)}filterAvailableEmployees(e,t=0,i="ids"){if(!(e in this.availability))return[];let s=[];Array.isArray(t)?s=t.filter(L):0!==t&&s.push(t);let r=[];for(let t in this.availability[e].employees){t=_(t);let i=this.availability[e].employees[t];if(0===s.length)r.push(t);else{n(s,Object.keys(i.locations).map(_)).length>0&&r.push(t)}}return 0===r.length?[]:"entities"===i?r.map((e=>this.getEmployee(e))):r}filterAvailableLocations(e,t=0,i="ids"){if(!(e in this.availability))return[];let s=[];Array.isArray(t)?s=t.filter(L):0!==t&&s.push(t);let r=[];for(t in this.availability[e].employees){if(t=_(t),s.length>0&&-1===s.indexOf(t))continue;let i=this.availability[e].employees[t];for(let e in i.locations)r.push(_(e))}return r=r.filter(((e,t,i)=>i.indexOf(e)===t)),0===r.length?[]:"entities"===i?r.map((e=>this.getLocation(e))):r}}function B(e,t,i=!1){let s="";return s='<option value="'+e+'"'+(i?' selected="selected"':"")+">",s+=t,s+="</option>",s}function V(e,t){let i="";for(let s in e)i+=B(s,e[s],s==t);return i}function N(e,t,i,s){let r=V(t,s)+V(i,s);e.empty().append(r).val(s)}class R{constructor(e){this.$element=e,this.type=e.data("type"),this.$element.attr("data-inited","true")}}class Y extends R{constructor(e){super(e),this.$input=e.find("input").first(),this.$input.spectrum()}}window.mpa_intl_tel_input=function(e){const s=jQuery("<span/>",{id:e.attr("id")+"_error",class:"mpa-phone-field-error mpa-hide",text:o("Phone number is invalid.","motopress-appointment")});e.after("<br>",s);const r=t(e[0],{separateDialCode:!0,initialCountry:i.settings.country,hiddenInput:e.attr("name"),utilsScript:i.urls.plugin+"assets/js/intl-tel-input-17.0.19/js/utils.js"});r.promise.then((()=>{e.val()&&a(),e.on("countrychange",(e=>{a()})),e.on("input",(e=>{a()}))}));const a=()=>{r.isValidNumber()?(jQuery("input[type='hidden'][name='"+e.attr("name")+"']").val(r.getNumber(intlTelInputUtils.numberFormat.E164)),e.removeClass("mpa-phone-number--invalid"),s.addClass("mpa-hide")):(e.addClass("mpa-phone-number--invalid"),s.removeClass("mpa-hide"))};return r};class H{constructor(e,t){this.availability=t,this.availability.load().finally((()=>{this.defaultValuesDependency()})),this.widgetName="appointment_form",this.$widget=jQuery(e),this.widgetId=this.$widget.find('input[name="widget-id"]').val(),this.widgetInstanceNumber=this.widgetId.split("-").pop(),this.widgetFieldSelectorTemplate="#widget-"+this.widgetName+"-"+this.widgetInstanceNumber+"-",this.$showItemsCategory=this.findWidgetFieldElement("show_items-category"),this.$showItemsCategoryLabel=this.$showItemsCategory.parent(),this.$showItemsService=this.findWidgetFieldElement("show_items-service"),this.$showItemsServiceLabel=this.$showItemsService.parent(),this.$defaultCategory=this.findWidgetFieldElement("default_category"),this.$defaultService=this.findWidgetFieldElement("default_service"),this.$defaultLocation=this.findWidgetFieldElement("default_location"),this.$defaultEmployee=this.findWidgetFieldElement("default_employee"),this.showItemsCategoryProp=this.$showItemsCategory.prop("checked"),this.showItemsCategoryLabelTooltipText=h(o("To enable this option, you need to check the '%s' box.","motopress-appointment"),o("Service","motopress-appointment")),this.showItemsServiceLabelTooltipText=o("To enable booking for the specific service only, select the service below first, then uncheck the 'Service' box here.","motopress-appointment"),this.dependencyOfShowServiceToDefaultValueOfService(),this.toggleCategoryBasedOnService(),this.initColorPicker(),this.addListeners()}toggleLockCheckbox(e,t){const i=jQuery(`label[for="${e.attr("id")}"]`);t?(e.on("click.preventClick",(function(e){e.preventDefault()})),e.data("locked",!0),e.css({opacity:.6,cursor:"not-allowed"}),i.css("opacity",.6)):(e.off("click.preventClick"),e.removeData("locked"),e.css({opacity:1,cursor:"default"}),i.css("opacity",1))}isLockedCheckbox(e){return!!e.data("locked")}findWidgetFieldElement(e){return this.$widget.find(this.widgetFieldSelectorTemplate+e)}addListeners(){this.$showItemsCategory.on("change",(()=>this.updateShowItemsCategoryProp())),this.$showItemsService.on("change",(()=>this.toggleCategoryBasedOnService())),this.$defaultService.on("change",(()=>this.dependencyOfShowServiceToDefaultValueOfService())),this.$showItemsServiceLabel.on("click",(()=>this.makeFocusToServiceSelect())),this.$defaultCategory.on("change",(()=>this.defaultValuesDependency())),this.$defaultService.on("change",(()=>this.defaultValuesDependency())),this.$defaultLocation.on("change",(()=>this.defaultValuesDependency())),this.$defaultEmployee.on("change",(()=>this.defaultValuesDependency()))}updateShowItemsCategoryProp(){this.showItemsCategoryProp=this.$showItemsCategory.prop("checked")}toggleCategoryBasedOnService(){!1===this.$showItemsService.prop("checked")?(this.toggleLockCheckbox(this.$showItemsCategory,!0),this.$showItemsCategory.prop("checked",!1),this.$showItemsCategoryLabel.toggleClass("mpa_tooltip",!0),this.$showItemsCategoryLabel.attr("data-tooltip",this.showItemsCategoryLabelTooltipText)):(this.toggleLockCheckbox(this.$showItemsCategory,!1),this.$showItemsCategory.prop("checked",this.showItemsCategoryProp),this.$showItemsCategoryLabel.toggleClass("mpa_tooltip",!1))}dependencyOfShowServiceToDefaultValueOfService(){this.$defaultService.val()&&"0"!==this.$defaultService.val()?(this.toggleLockCheckbox(this.$showItemsService,!1),this.$showItemsServiceLabel.toggleClass("mpa_tooltip",!1),this.$showItemsServiceLabel.removeAttr("data-tooltip")):(this.toggleLockCheckbox(this.$showItemsService,!0),this.$showItemsService.prop("checked",!0),this.$showItemsServiceLabel.toggleClass("mpa_tooltip",!0),this.$showItemsServiceLabel.attr("data-tooltip",this.showItemsServiceLabelTooltipText))}makeFocusToServiceSelect(){!0===this.isLockedCheckbox(this.$showItemsService)&&this.$defaultService.focus()}defaultValuesDependency(){const e=jQuery("#_mpa_label_unselected").val(),t=e||o("— Select —","motopress-appointment"),i=jQuery("#_mpa_label_option").val(),s=i||o("— Any —","motopress-appointment"),r=this.$defaultCategory.val(),a=_(this.$defaultService.val()),n=_(this.$defaultEmployee.val()),l=_(this.$defaultLocation.val()),h=this.availability.isAvailableService(a)?a:0,u=this.availability.isAvailableServiceCategory(r)?r:"",p=this.availability.isAvailableLocation(l)?l:0,c=this.availability.isAvailableEmployee(n)?n:0,m=this.availability.getAvailableServiceCategories(),d=this.availability.getAvailableServices(u,p,c),g=this.availability.getAvailableLocations(h,c),y=this.availability.getAvailableEmployees(h,p);N(this.$defaultCategory,{"":s},m,m.hasOwnProperty(u)?u:""),N(this.$defaultService,{0:t},d,d.hasOwnProperty(h)?h:0),N(this.$defaultLocation,{0:s},g,g.hasOwnProperty(p)?p:0),N(this.$defaultEmployee,{0:s},y,y.hasOwnProperty(c)?c:0)}initColorPicker(){this.$widget.find(".mpa-color-picker-ctrl").each((function(e,t){let i=jQuery(t);new Y(i)}))}}jQuery(document).ready((function(){const e=new W;jQuery('.widget[id*="appointment_form"]').not('[id*="__i__"]').each((function(){new H(this,e)})),jQuery(document).on("widget-added widget-updated",(function(t,i){"appointment_form"===i.find('input[name="id_base"]').val()&&new H(i,e)}))}))}(wp.date,intlTelInput,mpaData)}();
